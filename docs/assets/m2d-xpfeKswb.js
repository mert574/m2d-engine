var ge=F=>{throw TypeError(F)};var ve=(F,f,c)=>f.has(F)||ge("Cannot "+c);var te=(F,f,c)=>(ve(F,f,"read from private field"),c?c.call(F):f.get(F)),ie=(F,f,c)=>f.has(F)?ge("Cannot add the same private member more than once"):f instanceof WeakSet?f.add(F):f.set(F,c),ne=(F,f,c,p)=>(ve(F,f,"write to private field"),p?p.call(F,c):f.set(F,c),c);(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))p(h);new MutationObserver(h=>{for(const e of h)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&p(o)}).observe(document,{childList:!0,subtree:!0});function c(h){const e={};return h.integrity&&(e.integrity=h.integrity),h.referrerPolicy&&(e.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?e.credentials="include":h.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function p(h){if(h.ep)return;h.ep=!0;const e=c(h);fetch(h.href,e)}})();const Ae="modulepreload",Ie=function(F){return"/m2d-engine/"+F},me={},Ze=function(f,c,p){let h=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));h=Promise.allSettled(c.map(s=>{if(s=Ie(s),s in me)return;me[s]=!0;const g=s.endsWith(".css"),l=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${l}`))return;const d=document.createElement("link");if(d.rel=g?"stylesheet":Ae,g||(d.as="script"),d.crossOrigin="",d.href=s,a&&d.setAttribute("nonce",a),document.head.appendChild(d),g)return new Promise((r,t)=>{d.addEventListener("load",r),d.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${s}`)))})}))}function e(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return h.then(o=>{for(const a of o||[])a.status==="rejected"&&e(a.reason);return f().catch(e)})};var se=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Te(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}var we={exports:{}};/*!
 * matter-js 0.19.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(F,f){(function(p,h){F.exports=h()})(se,function(){return function(c){var p={};function h(e){if(p[e])return p[e].exports;var o=p[e]={i:e,l:!1,exports:{}};return c[e].call(o.exports,o,o.exports,h),o.l=!0,o.exports}return h.m=c,h.c=p,h.d=function(e,o,a){h.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:a})},h.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},h.t=function(e,o){if(o&1&&(e=h(e)),o&8||o&4&&typeof e=="object"&&e&&e.__esModule)return e;var a=Object.create(null);if(h.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),o&2&&typeof e!="string")for(var s in e)h.d(a,s,(function(g){return e[g]}).bind(null,s));return a},h.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return h.d(o,"a",o),o},h.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},h.p="",h(h.s=20)}([function(c,p){var h={};c.exports=h,function(){h._baseDelta=1e3/60,h._nextId=0,h._seed=0,h._nowStartTime=+new Date,h._warnedOnce={},h._decomp=null,h.extend=function(o,a){var s,g;typeof a=="boolean"?(s=2,g=a):(s=1,g=!0);for(var l=s;l<arguments.length;l++){var d=arguments[l];if(d)for(var r in d)g&&d[r]&&d[r].constructor===Object&&(!o[r]||o[r].constructor===Object)?(o[r]=o[r]||{},h.extend(o[r],g,d[r])):o[r]=d[r]}return o},h.clone=function(o,a){return h.extend({},a,o)},h.keys=function(o){if(Object.keys)return Object.keys(o);var a=[];for(var s in o)a.push(s);return a},h.values=function(o){var a=[];if(Object.keys){for(var s=Object.keys(o),g=0;g<s.length;g++)a.push(o[s[g]]);return a}for(var l in o)a.push(o[l]);return a},h.get=function(o,a,s,g){a=a.split(".").slice(s,g);for(var l=0;l<a.length;l+=1)o=o[a[l]];return o},h.set=function(o,a,s,g,l){var d=a.split(".").slice(g,l);return h.get(o,a,0,-1)[d[d.length-1]]=s,s},h.shuffle=function(o){for(var a=o.length-1;a>0;a--){var s=Math.floor(h.random()*(a+1)),g=o[a];o[a]=o[s],o[s]=g}return o},h.choose=function(o){return o[Math.floor(h.random()*o.length)]},h.isElement=function(o){return typeof HTMLElement<"u"?o instanceof HTMLElement:!!(o&&o.nodeType&&o.nodeName)},h.isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"},h.isFunction=function(o){return typeof o=="function"},h.isPlainObject=function(o){return typeof o=="object"&&o.constructor===Object},h.isString=function(o){return toString.call(o)==="[object String]"},h.clamp=function(o,a,s){return o<a?a:o>s?s:o},h.sign=function(o){return o<0?-1:1},h.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-h._nowStartTime},h.random=function(o,a){return o=typeof o<"u"?o:0,a=typeof a<"u"?a:1,o+e()*(a-o)};var e=function(){return h._seed=(h._seed*9301+49297)%233280,h._seed/233280};h.colorToNumber=function(o){return o=o.replace("#",""),o.length==3&&(o=o.charAt(0)+o.charAt(0)+o.charAt(1)+o.charAt(1)+o.charAt(2)+o.charAt(2)),parseInt(o,16)},h.logLevel=1,h.log=function(){console&&h.logLevel>0&&h.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.info=function(){console&&h.logLevel>0&&h.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.warn=function(){console&&h.logLevel>0&&h.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},h.warnOnce=function(){var o=Array.prototype.slice.call(arguments).join(" ");h._warnedOnce[o]||(h.warn(o),h._warnedOnce[o]=!0)},h.deprecated=function(o,a,s){o[a]=h.chain(function(){h.warnOnce("🔅 deprecated 🔅",s)},o[a])},h.nextId=function(){return h._nextId++},h.indexOf=function(o,a){if(o.indexOf)return o.indexOf(a);for(var s=0;s<o.length;s++)if(o[s]===a)return s;return-1},h.map=function(o,a){if(o.map)return o.map(a);for(var s=[],g=0;g<o.length;g+=1)s.push(a(o[g]));return s},h.topologicalSort=function(o){var a=[],s=[],g=[];for(var l in o)!s[l]&&!g[l]&&h._topologicalSort(l,s,g,o,a);return a},h._topologicalSort=function(o,a,s,g,l){var d=g[o]||[];s[o]=!0;for(var r=0;r<d.length;r+=1){var t=d[r];s[t]||a[t]||h._topologicalSort(t,a,s,g,l)}s[o]=!1,a[o]=!0,l.push(o)},h.chain=function(){for(var o=[],a=0;a<arguments.length;a+=1){var s=arguments[a];s._chained?o.push.apply(o,s._chained):o.push(s)}var g=function(){for(var l,d=new Array(arguments.length),r=0,t=arguments.length;r<t;r++)d[r]=arguments[r];for(r=0;r<o.length;r+=1){var i=o[r].apply(l,d);typeof i<"u"&&(l=i)}return l};return g._chained=o,g},h.chainPathBefore=function(o,a,s){return h.set(o,a,h.chain(s,h.get(o,a)))},h.chainPathAfter=function(o,a,s){return h.set(o,a,h.chain(h.get(o,a),s))},h.setDecomp=function(o){h._decomp=o},h.getDecomp=function(){var o=h._decomp;try{!o&&typeof window<"u"&&(o=window.decomp),!o&&typeof se<"u"&&(o=se.decomp)}catch{o=null}return o}}()},function(c,p){var h={};c.exports=h,function(){h.create=function(e){var o={min:{x:0,y:0},max:{x:0,y:0}};return e&&h.update(o,e),o},h.update=function(e,o,a){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var s=0;s<o.length;s++){var g=o[s];g.x>e.max.x&&(e.max.x=g.x),g.x<e.min.x&&(e.min.x=g.x),g.y>e.max.y&&(e.max.y=g.y),g.y<e.min.y&&(e.min.y=g.y)}a&&(a.x>0?e.max.x+=a.x:e.min.x+=a.x,a.y>0?e.max.y+=a.y:e.min.y+=a.y)},h.contains=function(e,o){return o.x>=e.min.x&&o.x<=e.max.x&&o.y>=e.min.y&&o.y<=e.max.y},h.overlaps=function(e,o){return e.min.x<=o.max.x&&e.max.x>=o.min.x&&e.max.y>=o.min.y&&e.min.y<=o.max.y},h.translate=function(e,o){e.min.x+=o.x,e.max.x+=o.x,e.min.y+=o.y,e.max.y+=o.y},h.shift=function(e,o){var a=e.max.x-e.min.x,s=e.max.y-e.min.y;e.min.x=o.x,e.max.x=o.x+a,e.min.y=o.y,e.max.y=o.y+s}}()},function(c,p){var h={};c.exports=h,function(){h.create=function(e,o){return{x:e||0,y:o||0}},h.clone=function(e){return{x:e.x,y:e.y}},h.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},h.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},h.rotate=function(e,o,a){var s=Math.cos(o),g=Math.sin(o);a||(a={});var l=e.x*s-e.y*g;return a.y=e.x*g+e.y*s,a.x=l,a},h.rotateAbout=function(e,o,a,s){var g=Math.cos(o),l=Math.sin(o);s||(s={});var d=a.x+((e.x-a.x)*g-(e.y-a.y)*l);return s.y=a.y+((e.x-a.x)*l+(e.y-a.y)*g),s.x=d,s},h.normalise=function(e){var o=h.magnitude(e);return o===0?{x:0,y:0}:{x:e.x/o,y:e.y/o}},h.dot=function(e,o){return e.x*o.x+e.y*o.y},h.cross=function(e,o){return e.x*o.y-e.y*o.x},h.cross3=function(e,o,a){return(o.x-e.x)*(a.y-e.y)-(o.y-e.y)*(a.x-e.x)},h.add=function(e,o,a){return a||(a={}),a.x=e.x+o.x,a.y=e.y+o.y,a},h.sub=function(e,o,a){return a||(a={}),a.x=e.x-o.x,a.y=e.y-o.y,a},h.mult=function(e,o){return{x:e.x*o,y:e.y*o}},h.div=function(e,o){return{x:e.x/o,y:e.y/o}},h.perp=function(e,o){return o=o===!0?-1:1,{x:o*-e.y,y:o*e.x}},h.neg=function(e){return{x:-e.x,y:-e.y}},h.angle=function(e,o){return Math.atan2(o.y-e.y,o.x-e.x)},h._temp=[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()]}()},function(c,p,h){var e={};c.exports=e;var o=h(2),a=h(0);(function(){e.create=function(s,g){for(var l=[],d=0;d<s.length;d++){var r=s[d],t={x:r.x,y:r.y,index:d,body:g,isInternal:!1};l.push(t)}return l},e.fromPath=function(s,g){var l=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,d=[];return s.replace(l,function(r,t,i){d.push({x:parseFloat(t),y:parseFloat(i)})}),e.create(d,g)},e.centre=function(s){for(var g=e.area(s,!0),l={x:0,y:0},d,r,t,i=0;i<s.length;i++)t=(i+1)%s.length,d=o.cross(s[i],s[t]),r=o.mult(o.add(s[i],s[t]),d),l=o.add(l,r);return o.div(l,6*g)},e.mean=function(s){for(var g={x:0,y:0},l=0;l<s.length;l++)g.x+=s[l].x,g.y+=s[l].y;return o.div(g,s.length)},e.area=function(s,g){for(var l=0,d=s.length-1,r=0;r<s.length;r++)l+=(s[d].x-s[r].x)*(s[d].y+s[r].y),d=r;return g?l/2:Math.abs(l)/2},e.inertia=function(s,g){for(var l=0,d=0,r=s,t,i,n=0;n<r.length;n++)i=(n+1)%r.length,t=Math.abs(o.cross(r[i],r[n])),l+=t*(o.dot(r[i],r[i])+o.dot(r[i],r[n])+o.dot(r[n],r[n])),d+=t;return g/6*(l/d)},e.translate=function(s,g,l){l=typeof l<"u"?l:1;var d=s.length,r=g.x*l,t=g.y*l,i;for(i=0;i<d;i++)s[i].x+=r,s[i].y+=t;return s},e.rotate=function(s,g,l){if(g!==0){var d=Math.cos(g),r=Math.sin(g),t=l.x,i=l.y,n=s.length,u,m,C,P;for(P=0;P<n;P++)u=s[P],m=u.x-t,C=u.y-i,u.x=t+(m*d-C*r),u.y=i+(m*r+C*d);return s}},e.contains=function(s,g){for(var l=g.x,d=g.y,r=s.length,t=s[r-1],i,n=0;n<r;n++){if(i=s[n],(l-t.x)*(i.y-t.y)+(d-t.y)*(t.x-i.x)>0)return!1;t=i}return!0},e.scale=function(s,g,l,d){if(g===1&&l===1)return s;d=d||e.centre(s);for(var r,t,i=0;i<s.length;i++)r=s[i],t=o.sub(r,d),s[i].x=d.x+t.x*g,s[i].y=d.y+t.y*l;return s},e.chamfer=function(s,g,l,d,r){typeof g=="number"?g=[g]:g=g||[8],l=typeof l<"u"?l:-1,d=d||2,r=r||14;for(var t=[],i=0;i<s.length;i++){var n=s[i-1>=0?i-1:s.length-1],u=s[i],m=s[(i+1)%s.length],C=g[i<g.length?i:g.length-1];if(C===0){t.push(u);continue}var P=o.normalise({x:u.y-n.y,y:n.x-u.x}),E=o.normalise({x:m.y-u.y,y:u.x-m.x}),v=Math.sqrt(2*Math.pow(C,2)),y=o.mult(a.clone(P),C),w=o.normalise(o.mult(o.add(P,E),.5)),x=o.sub(u,o.mult(w,v)),M=l;l===-1&&(M=Math.pow(C,.32)*1.75),M=a.clamp(M,d,r),M%2===1&&(M+=1);for(var S=Math.acos(o.dot(P,E)),I=S/M,A=0;A<M;A++)t.push(o.add(o.rotate(y,I*A),x))}return t},e.clockwiseSort=function(s){var g=e.mean(s);return s.sort(function(l,d){return o.angle(g,l)-o.angle(g,d)}),s},e.isConvex=function(s){var g=0,l=s.length,d,r,t,i;if(l<3)return null;for(d=0;d<l;d++)if(r=(d+1)%l,t=(d+2)%l,i=(s[r].x-s[d].x)*(s[t].y-s[r].y),i-=(s[r].y-s[d].y)*(s[t].x-s[r].x),i<0?g|=1:i>0&&(g|=2),g===3)return!1;return g!==0?!0:null},e.hull=function(s){var g=[],l=[],d,r;for(s=s.slice(0),s.sort(function(t,i){var n=t.x-i.x;return n!==0?n:t.y-i.y}),r=0;r<s.length;r+=1){for(d=s[r];l.length>=2&&o.cross3(l[l.length-2],l[l.length-1],d)<=0;)l.pop();l.push(d)}for(r=s.length-1;r>=0;r-=1){for(d=s[r];g.length>=2&&o.cross3(g[g.length-2],g[g.length-1],d)<=0;)g.pop();g.push(d)}return g.pop(),l.pop(),g.concat(l)}})()},function(c,p,h){var e={};c.exports=e;var o=h(3),a=h(2),s=h(7),g=h(0),l=h(1),d=h(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var i={id:g.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:o.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},n=g.extend(i,t);return r(n,t),n},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var r=function(t,i){i=i||{},e.set(t,{bounds:t.bounds||l.create(t.vertices),positionPrev:t.positionPrev||a.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),o.rotate(t.vertices,t.angle,t.position),d.rotate(t.axes,t.angle),l.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:i.axes||t.axes,area:i.area||t.area,mass:i.mass||t.mass,inertia:i.inertia||t.inertia});var n=t.isStatic?"#14151f":g.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),u=t.isStatic?"#555":"#ccc",m=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||n,t.render.strokeStyle=t.render.strokeStyle||u,t.render.lineWidth=t.render.lineWidth||m,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,i,n){var u;typeof i=="string"&&(u=i,i={},i[u]=n);for(u in i)if(Object.prototype.hasOwnProperty.call(i,u))switch(n=i[u],u){case"isStatic":e.setStatic(t,n);break;case"isSleeping":s.set(t,n);break;case"mass":e.setMass(t,n);break;case"density":e.setDensity(t,n);break;case"inertia":e.setInertia(t,n);break;case"vertices":e.setVertices(t,n);break;case"position":e.setPosition(t,n);break;case"angle":e.setAngle(t,n);break;case"velocity":e.setVelocity(t,n);break;case"angularVelocity":e.setAngularVelocity(t,n);break;case"speed":e.setSpeed(t,n);break;case"angularSpeed":e.setAngularSpeed(t,n);break;case"parts":e.setParts(t,n);break;case"centre":e.setCentre(t,n);break;default:t[u]=n}},e.setStatic=function(t,i){for(var n=0;n<t.parts.length;n++){var u=t.parts[n];u.isStatic=i,i?(u._original={restitution:u.restitution,friction:u.friction,mass:u.mass,inertia:u.inertia,density:u.density,inverseMass:u.inverseMass,inverseInertia:u.inverseInertia},u.restitution=0,u.friction=1,u.mass=u.inertia=u.density=1/0,u.inverseMass=u.inverseInertia=0,u.positionPrev.x=u.position.x,u.positionPrev.y=u.position.y,u.anglePrev=u.angle,u.angularVelocity=0,u.speed=0,u.angularSpeed=0,u.motion=0):u._original&&(u.restitution=u._original.restitution,u.friction=u._original.friction,u.mass=u._original.mass,u.inertia=u._original.inertia,u.density=u._original.density,u.inverseMass=u._original.inverseMass,u.inverseInertia=u._original.inverseInertia,u._original=null)}},e.setMass=function(t,i){var n=t.inertia/(t.mass/6);t.inertia=n*(i/6),t.inverseInertia=1/t.inertia,t.mass=i,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,i){e.setMass(t,i*t.area),t.density=i},e.setInertia=function(t,i){t.inertia=i,t.inverseInertia=1/t.inertia},e.setVertices=function(t,i){i[0].body===t?t.vertices=i:t.vertices=o.create(i,t),t.axes=d.fromVertices(t.vertices),t.area=o.area(t.vertices),e.setMass(t,t.density*t.area);var n=o.centre(t.vertices);o.translate(t.vertices,n,-1),e.setInertia(t,e._inertiaScale*o.inertia(t.vertices,t.mass)),o.translate(t.vertices,t.position),l.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,i,n){var u;for(i=i.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,u=0;u<i.length;u++){var m=i[u];m!==t&&(m.parent=t,t.parts.push(m))}if(t.parts.length!==1){if(n=typeof n<"u"?n:!0,n){var C=[];for(u=0;u<i.length;u++)C=C.concat(i[u].vertices);o.clockwiseSort(C);var P=o.hull(C),E=o.centre(P);e.setVertices(t,P),o.translate(t.vertices,E)}var v=e._totalProperties(t);t.area=v.area,t.parent=t,t.position.x=v.centre.x,t.position.y=v.centre.y,t.positionPrev.x=v.centre.x,t.positionPrev.y=v.centre.y,e.setMass(t,v.mass),e.setInertia(t,v.inertia),e.setPosition(t,v.centre)}},e.setCentre=function(t,i,n){n?(t.positionPrev.x+=i.x,t.positionPrev.y+=i.y,t.position.x+=i.x,t.position.y+=i.y):(t.positionPrev.x=i.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=i.y-(t.position.y-t.positionPrev.y),t.position.x=i.x,t.position.y=i.y)},e.setPosition=function(t,i,n){var u=a.sub(i,t.position);n?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=u.x,t.velocity.y=u.y,t.speed=a.magnitude(u)):(t.positionPrev.x+=u.x,t.positionPrev.y+=u.y);for(var m=0;m<t.parts.length;m++){var C=t.parts[m];C.position.x+=u.x,C.position.y+=u.y,o.translate(C.vertices,u),l.update(C.bounds,C.vertices,t.velocity)}},e.setAngle=function(t,i,n){var u=i-t.angle;n?(t.anglePrev=t.angle,t.angularVelocity=u,t.angularSpeed=Math.abs(u)):t.anglePrev+=u;for(var m=0;m<t.parts.length;m++){var C=t.parts[m];C.angle+=u,o.rotate(C.vertices,u,t.position),d.rotate(C.axes,u),l.update(C.bounds,C.vertices,t.velocity),m>0&&a.rotateAbout(C.position,u,t.position,C.position)}},e.setVelocity=function(t,i){var n=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-i.x*n,t.positionPrev.y=t.position.y-i.y*n,t.velocity.x=(t.position.x-t.positionPrev.x)/n,t.velocity.y=(t.position.y-t.positionPrev.y)/n,t.speed=a.magnitude(t.velocity)},e.getVelocity=function(t){var i=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*i,y:(t.position.y-t.positionPrev.y)*i}},e.getSpeed=function(t){return a.magnitude(e.getVelocity(t))},e.setSpeed=function(t,i){e.setVelocity(t,a.mult(a.normalise(e.getVelocity(t)),i))},e.setAngularVelocity=function(t,i){var n=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-i*n,t.angularVelocity=(t.angle-t.anglePrev)/n,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,i){e.setAngularVelocity(t,g.sign(e.getAngularVelocity(t))*i)},e.translate=function(t,i,n){e.setPosition(t,a.add(t.position,i),n)},e.rotate=function(t,i,n,u){if(!n)e.setAngle(t,t.angle+i,u);else{var m=Math.cos(i),C=Math.sin(i),P=t.position.x-n.x,E=t.position.y-n.y;e.setPosition(t,{x:n.x+(P*m-E*C),y:n.y+(P*C+E*m)},u),e.setAngle(t,t.angle+i,u)}},e.scale=function(t,i,n,u){var m=0,C=0;u=u||t.position;for(var P=0;P<t.parts.length;P++){var E=t.parts[P];o.scale(E.vertices,i,n,u),E.axes=d.fromVertices(E.vertices),E.area=o.area(E.vertices),e.setMass(E,t.density*E.area),o.translate(E.vertices,{x:-E.position.x,y:-E.position.y}),e.setInertia(E,e._inertiaScale*o.inertia(E.vertices,E.mass)),o.translate(E.vertices,{x:E.position.x,y:E.position.y}),P>0&&(m+=E.area,C+=E.inertia),E.position.x=u.x+(E.position.x-u.x)*i,E.position.y=u.y+(E.position.y-u.y)*n,l.update(E.bounds,E.vertices,t.velocity)}t.parts.length>1&&(t.area=m,t.isStatic||(e.setMass(t,t.density*m),e.setInertia(t,C))),t.circleRadius&&(i===n?t.circleRadius*=i:t.circleRadius=null)},e.update=function(t,i){i=(typeof i<"u"?i:1e3/60)*t.timeScale;var n=i*i,u=e._timeCorrection?i/(t.deltaTime||i):1,m=1-t.frictionAir*(i/g._baseDelta),C=(t.position.x-t.positionPrev.x)*u,P=(t.position.y-t.positionPrev.y)*u;t.velocity.x=C*m+t.force.x/t.mass*n,t.velocity.y=P*m+t.force.y/t.mass*n,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=i,t.angularVelocity=(t.angle-t.anglePrev)*m*u+t.torque/t.inertia*n,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var E=0;E<t.parts.length;E++){var v=t.parts[E];o.translate(v.vertices,t.velocity),E>0&&(v.position.x+=t.velocity.x,v.position.y+=t.velocity.y),t.angularVelocity!==0&&(o.rotate(v.vertices,t.angularVelocity,t.position),d.rotate(v.axes,t.angularVelocity),E>0&&a.rotateAbout(v.position,t.angularVelocity,t.position,v.position)),l.update(v.bounds,v.vertices,t.velocity)}},e.updateVelocities=function(t){var i=e._baseDelta/t.deltaTime,n=t.velocity;n.x=(t.position.x-t.positionPrev.x)*i,n.y=(t.position.y-t.positionPrev.y)*i,t.speed=Math.sqrt(n.x*n.x+n.y*n.y),t.angularVelocity=(t.angle-t.anglePrev)*i,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,i,n){var u={x:i.x-t.position.x,y:i.y-t.position.y};t.force.x+=n.x,t.force.y+=n.y,t.torque+=u.x*n.y-u.y*n.x},e._totalProperties=function(t){for(var i={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=t.parts.length===1?0:1;n<t.parts.length;n++){var u=t.parts[n],m=u.mass!==1/0?u.mass:1;i.mass+=m,i.area+=u.area,i.inertia+=u.inertia,i.centre=a.add(i.centre,a.mult(u.position,m))}return i.centre=a.div(i.centre,i.mass),i}})()},function(c,p,h){var e={};c.exports=e;var o=h(0);(function(){e.on=function(a,s,g){for(var l=s.split(" "),d,r=0;r<l.length;r++)d=l[r],a.events=a.events||{},a.events[d]=a.events[d]||[],a.events[d].push(g);return g},e.off=function(a,s,g){if(!s){a.events={};return}typeof s=="function"&&(g=s,s=o.keys(a.events).join(" "));for(var l=s.split(" "),d=0;d<l.length;d++){var r=a.events[l[d]],t=[];if(g&&r)for(var i=0;i<r.length;i++)r[i]!==g&&t.push(r[i]);a.events[l[d]]=t}},e.trigger=function(a,s,g){var l,d,r,t,i=a.events;if(i&&o.keys(i).length>0){g||(g={}),l=s.split(" ");for(var n=0;n<l.length;n++)if(d=l[n],r=i[d],r){t=o.clone(g,!1),t.name=d,t.source=a;for(var u=0;u<r.length;u++)r[u].apply(a,[t])}}}})()},function(c,p,h){var e={};c.exports=e;var o=h(5),a=h(0),s=h(1),g=h(4);(function(){e.create=function(l){return a.extend({id:a.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},l)},e.setModified=function(l,d,r,t){if(l.isModified=d,d&&l.cache&&(l.cache.allBodies=null,l.cache.allConstraints=null,l.cache.allComposites=null),r&&l.parent&&e.setModified(l.parent,d,r,t),t)for(var i=0;i<l.composites.length;i++){var n=l.composites[i];e.setModified(n,d,r,t)}},e.add=function(l,d){var r=[].concat(d);o.trigger(l,"beforeAdd",{object:d});for(var t=0;t<r.length;t++){var i=r[t];switch(i.type){case"body":if(i.parent!==i){a.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(l,i);break;case"constraint":e.addConstraint(l,i);break;case"composite":e.addComposite(l,i);break;case"mouseConstraint":e.addConstraint(l,i.constraint);break}}return o.trigger(l,"afterAdd",{object:d}),l},e.remove=function(l,d,r){var t=[].concat(d);o.trigger(l,"beforeRemove",{object:d});for(var i=0;i<t.length;i++){var n=t[i];switch(n.type){case"body":e.removeBody(l,n,r);break;case"constraint":e.removeConstraint(l,n,r);break;case"composite":e.removeComposite(l,n,r);break;case"mouseConstraint":e.removeConstraint(l,n.constraint);break}}return o.trigger(l,"afterRemove",{object:d}),l},e.addComposite=function(l,d){return l.composites.push(d),d.parent=l,e.setModified(l,!0,!0,!1),l},e.removeComposite=function(l,d,r){var t=a.indexOf(l.composites,d);if(t!==-1&&e.removeCompositeAt(l,t),r)for(var i=0;i<l.composites.length;i++)e.removeComposite(l.composites[i],d,!0);return l},e.removeCompositeAt=function(l,d){return l.composites.splice(d,1),e.setModified(l,!0,!0,!1),l},e.addBody=function(l,d){return l.bodies.push(d),e.setModified(l,!0,!0,!1),l},e.removeBody=function(l,d,r){var t=a.indexOf(l.bodies,d);if(t!==-1&&e.removeBodyAt(l,t),r)for(var i=0;i<l.composites.length;i++)e.removeBody(l.composites[i],d,!0);return l},e.removeBodyAt=function(l,d){return l.bodies.splice(d,1),e.setModified(l,!0,!0,!1),l},e.addConstraint=function(l,d){return l.constraints.push(d),e.setModified(l,!0,!0,!1),l},e.removeConstraint=function(l,d,r){var t=a.indexOf(l.constraints,d);if(t!==-1&&e.removeConstraintAt(l,t),r)for(var i=0;i<l.composites.length;i++)e.removeConstraint(l.composites[i],d,!0);return l},e.removeConstraintAt=function(l,d){return l.constraints.splice(d,1),e.setModified(l,!0,!0,!1),l},e.clear=function(l,d,r){if(r)for(var t=0;t<l.composites.length;t++)e.clear(l.composites[t],d,!0);return d?l.bodies=l.bodies.filter(function(i){return i.isStatic}):l.bodies.length=0,l.constraints.length=0,l.composites.length=0,e.setModified(l,!0,!0,!1),l},e.allBodies=function(l){if(l.cache&&l.cache.allBodies)return l.cache.allBodies;for(var d=[].concat(l.bodies),r=0;r<l.composites.length;r++)d=d.concat(e.allBodies(l.composites[r]));return l.cache&&(l.cache.allBodies=d),d},e.allConstraints=function(l){if(l.cache&&l.cache.allConstraints)return l.cache.allConstraints;for(var d=[].concat(l.constraints),r=0;r<l.composites.length;r++)d=d.concat(e.allConstraints(l.composites[r]));return l.cache&&(l.cache.allConstraints=d),d},e.allComposites=function(l){if(l.cache&&l.cache.allComposites)return l.cache.allComposites;for(var d=[].concat(l.composites),r=0;r<l.composites.length;r++)d=d.concat(e.allComposites(l.composites[r]));return l.cache&&(l.cache.allComposites=d),d},e.get=function(l,d,r){var t,i;switch(r){case"body":t=e.allBodies(l);break;case"constraint":t=e.allConstraints(l);break;case"composite":t=e.allComposites(l).concat(l);break}return t?(i=t.filter(function(n){return n.id.toString()===d.toString()}),i.length===0?null:i[0]):null},e.move=function(l,d,r){return e.remove(l,d),e.add(r,d),l},e.rebase=function(l){for(var d=e.allBodies(l).concat(e.allConstraints(l)).concat(e.allComposites(l)),r=0;r<d.length;r++)d[r].id=a.nextId();return l},e.translate=function(l,d,r){for(var t=r?e.allBodies(l):l.bodies,i=0;i<t.length;i++)g.translate(t[i],d);return l},e.rotate=function(l,d,r,t){for(var i=Math.cos(d),n=Math.sin(d),u=t?e.allBodies(l):l.bodies,m=0;m<u.length;m++){var C=u[m],P=C.position.x-r.x,E=C.position.y-r.y;g.setPosition(C,{x:r.x+(P*i-E*n),y:r.y+(P*n+E*i)}),g.rotate(C,d)}return l},e.scale=function(l,d,r,t,i){for(var n=i?e.allBodies(l):l.bodies,u=0;u<n.length;u++){var m=n[u],C=m.position.x-t.x,P=m.position.y-t.y;g.setPosition(m,{x:t.x+C*d,y:t.y+P*r}),g.scale(m,d,r)}return l},e.bounds=function(l){for(var d=e.allBodies(l),r=[],t=0;t<d.length;t+=1){var i=d[t];r.push(i.bounds.min,i.bounds.max)}return s.create(r)}})()},function(c,p,h){var e={};c.exports=e;var o=h(4),a=h(5),s=h(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(g,l){for(var d=l/s._baseDelta,r=e._motionSleepThreshold,t=0;t<g.length;t++){var i=g[t],n=o.getSpeed(i),u=o.getAngularSpeed(i),m=n*n+u*u;if(i.force.x!==0||i.force.y!==0){e.set(i,!1);continue}var C=Math.min(i.motion,m),P=Math.max(i.motion,m);i.motion=e._minBias*C+(1-e._minBias)*P,i.sleepThreshold>0&&i.motion<r?(i.sleepCounter+=1,i.sleepCounter>=i.sleepThreshold/d&&e.set(i,!0)):i.sleepCounter>0&&(i.sleepCounter-=1)}},e.afterCollisions=function(g){for(var l=e._motionSleepThreshold,d=0;d<g.length;d++){var r=g[d];if(r.isActive){var t=r.collision,i=t.bodyA.parent,n=t.bodyB.parent;if(!(i.isSleeping&&n.isSleeping||i.isStatic||n.isStatic)&&(i.isSleeping||n.isSleeping)){var u=i.isSleeping&&!i.isStatic?i:n,m=u===i?n:i;!u.isStatic&&m.motion>l&&e.set(u,!1)}}}},e.set=function(g,l){var d=g.isSleeping;l?(g.isSleeping=!0,g.sleepCounter=g.sleepThreshold,g.positionImpulse.x=0,g.positionImpulse.y=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.speed=0,g.angularSpeed=0,g.motion=0,d||a.trigger(g,"sleepStart")):(g.isSleeping=!1,g.sleepCounter=0,d&&a.trigger(g,"sleepEnd"))}})()},function(c,p,h){var e={};c.exports=e;var o=h(3),a=h(9);(function(){var s=[],g={overlap:0,axis:null},l={overlap:0,axis:null};e.create=function(d,r){return{pair:null,collided:!1,bodyA:d,bodyB:r,parentA:d.parent,parentB:r.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},e.collides=function(d,r,t){if(e._overlapAxes(g,d.vertices,r.vertices,d.axes),g.overlap<=0||(e._overlapAxes(l,r.vertices,d.vertices,r.axes),l.overlap<=0))return null;var i=t&&t.table[a.id(d,r)],n;i?n=i.collision:(n=e.create(d,r),n.collided=!0,n.bodyA=d.id<r.id?d:r,n.bodyB=d.id<r.id?r:d,n.parentA=n.bodyA.parent,n.parentB=n.bodyB.parent),d=n.bodyA,r=n.bodyB;var u;g.overlap<l.overlap?u=g:u=l;var m=n.normal,C=n.supports,P=u.axis,E=P.x,v=P.y;E*(r.position.x-d.position.x)+v*(r.position.y-d.position.y)<0?(m.x=E,m.y=v):(m.x=-E,m.y=-v),n.tangent.x=-m.y,n.tangent.y=m.x,n.depth=u.overlap,n.penetration.x=m.x*n.depth,n.penetration.y=m.y*n.depth;var y=e._findSupports(d,r,m,1),w=0;if(o.contains(d.vertices,y[0])&&(C[w++]=y[0]),o.contains(d.vertices,y[1])&&(C[w++]=y[1]),w<2){var x=e._findSupports(r,d,m,-1);o.contains(r.vertices,x[0])&&(C[w++]=x[0]),w<2&&o.contains(r.vertices,x[1])&&(C[w++]=x[1])}return w===0&&(C[w++]=y[0]),C.length=w,n},e._overlapAxes=function(d,r,t,i){var n=r.length,u=t.length,m=r[0].x,C=r[0].y,P=t[0].x,E=t[0].y,v=i.length,y=Number.MAX_VALUE,w=0,x,M,S,I,A,T;for(A=0;A<v;A++){var k=i[A],L=k.x,R=k.y,B=m*L+C*R,D=P*L+E*R,W=B,O=D;for(T=1;T<n;T+=1)I=r[T].x*L+r[T].y*R,I>W?W=I:I<B&&(B=I);for(T=1;T<u;T+=1)I=t[T].x*L+t[T].y*R,I>O?O=I:I<D&&(D=I);if(M=W-D,S=O-B,x=M<S?M:S,x<y&&(y=x,w=A,x<=0))break}d.axis=i[w],d.overlap=y},e._projectToAxis=function(d,r,t){for(var i=r[0].x*t.x+r[0].y*t.y,n=i,u=1;u<r.length;u+=1){var m=r[u].x*t.x+r[u].y*t.y;m>n?n=m:m<i&&(i=m)}d.min=i,d.max=n},e._findSupports=function(d,r,t,i){var n=r.vertices,u=n.length,m=d.position.x,C=d.position.y,P=t.x*i,E=t.y*i,v=Number.MAX_VALUE,y,w,x,M,S;for(S=0;S<u;S+=1)w=n[S],M=P*(m-w.x)+E*(C-w.y),M<v&&(v=M,y=w);return x=n[(u+y.index-1)%u],v=P*(m-x.x)+E*(C-x.y),w=n[(y.index+1)%u],P*(m-w.x)+E*(C-w.y)<v?(s[0]=y,s[1]=w,s):(s[0]=y,s[1]=x,s)}})()},function(c,p,h){var e={};c.exports=e;var o=h(16);(function(){e.create=function(a,s){var g=a.bodyA,l=a.bodyB,d={id:e.id(g,l),bodyA:g,bodyB:l,collision:a,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:g.isSensor||l.isSensor,timeCreated:s,timeUpdated:s,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(d,a,s),d},e.update=function(a,s,g){var l=a.contacts,d=s.supports,r=a.activeContacts,t=s.parentA,i=s.parentB,n=t.vertices.length;a.isActive=!0,a.timeUpdated=g,a.collision=s,a.separation=s.depth,a.inverseMass=t.inverseMass+i.inverseMass,a.friction=t.friction<i.friction?t.friction:i.friction,a.frictionStatic=t.frictionStatic>i.frictionStatic?t.frictionStatic:i.frictionStatic,a.restitution=t.restitution>i.restitution?t.restitution:i.restitution,a.slop=t.slop>i.slop?t.slop:i.slop,s.pair=a,r.length=0;for(var u=0;u<d.length;u++){var m=d[u],C=m.body===t?m.index:n+m.index,P=l[C];P?r.push(P):r.push(l[C]=o.create(m))}},e.setActive=function(a,s,g){s?(a.isActive=!0,a.timeUpdated=g):(a.isActive=!1,a.activeContacts.length=0)},e.id=function(a,s){return a.id<s.id?"A"+a.id+"B"+s.id:"A"+s.id+"B"+a.id}})()},function(c,p,h){var e={};c.exports=e;var o=h(3),a=h(2),s=h(7),g=h(1),l=h(11),d=h(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(r){var t=r;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var i=t.bodyA?a.add(t.bodyA.position,t.pointA):t.pointA,n=t.bodyB?a.add(t.bodyB.position,t.pointB):t.pointB,u=a.magnitude(a.sub(i,n));t.length=typeof t.length<"u"?t.length:u,t.id=t.id||d.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var m={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(m.type="pin",m.anchors=!1):t.stiffness<.9&&(m.type="spring"),t.render=d.extend(m,t.render),t},e.preSolveAll=function(r){for(var t=0;t<r.length;t+=1){var i=r[t],n=i.constraintImpulse;i.isStatic||n.x===0&&n.y===0&&n.angle===0||(i.position.x+=n.x,i.position.y+=n.y,i.angle+=n.angle)}},e.solveAll=function(r,t){for(var i=d.clamp(t/d._baseDelta,0,1),n=0;n<r.length;n+=1){var u=r[n],m=!u.bodyA||u.bodyA&&u.bodyA.isStatic,C=!u.bodyB||u.bodyB&&u.bodyB.isStatic;(m||C)&&e.solve(r[n],i)}for(n=0;n<r.length;n+=1)u=r[n],m=!u.bodyA||u.bodyA&&u.bodyA.isStatic,C=!u.bodyB||u.bodyB&&u.bodyB.isStatic,!m&&!C&&e.solve(r[n],i)},e.solve=function(r,t){var i=r.bodyA,n=r.bodyB,u=r.pointA,m=r.pointB;if(!(!i&&!n)){i&&!i.isStatic&&(a.rotate(u,i.angle-r.angleA,u),r.angleA=i.angle),n&&!n.isStatic&&(a.rotate(m,n.angle-r.angleB,m),r.angleB=n.angle);var C=u,P=m;if(i&&(C=a.add(i.position,u)),n&&(P=a.add(n.position,m)),!(!C||!P)){var E=a.sub(C,P),v=a.magnitude(E);v<e._minLength&&(v=e._minLength);var y=(v-r.length)/v,w=r.stiffness>=1||r.length===0,x=w?r.stiffness*t:r.stiffness*t*t,M=r.damping*t,S=a.mult(E,y*x),I=(i?i.inverseMass:0)+(n?n.inverseMass:0),A=(i?i.inverseInertia:0)+(n?n.inverseInertia:0),T=I+A,k,L,R,B,D;if(M>0){var W=a.create();R=a.div(E,v),D=a.sub(n&&a.sub(n.position,n.positionPrev)||W,i&&a.sub(i.position,i.positionPrev)||W),B=a.dot(R,D)}i&&!i.isStatic&&(L=i.inverseMass/I,i.constraintImpulse.x-=S.x*L,i.constraintImpulse.y-=S.y*L,i.position.x-=S.x*L,i.position.y-=S.y*L,M>0&&(i.positionPrev.x-=M*R.x*B*L,i.positionPrev.y-=M*R.y*B*L),k=a.cross(u,S)/T*e._torqueDampen*i.inverseInertia*(1-r.angularStiffness),i.constraintImpulse.angle-=k,i.angle-=k),n&&!n.isStatic&&(L=n.inverseMass/I,n.constraintImpulse.x+=S.x*L,n.constraintImpulse.y+=S.y*L,n.position.x+=S.x*L,n.position.y+=S.y*L,M>0&&(n.positionPrev.x+=M*R.x*B*L,n.positionPrev.y+=M*R.y*B*L),k=a.cross(m,S)/T*e._torqueDampen*n.inverseInertia*(1-r.angularStiffness),n.constraintImpulse.angle+=k,n.angle+=k)}}},e.postSolveAll=function(r){for(var t=0;t<r.length;t++){var i=r[t],n=i.constraintImpulse;if(!(i.isStatic||n.x===0&&n.y===0&&n.angle===0)){s.set(i,!1);for(var u=0;u<i.parts.length;u++){var m=i.parts[u];o.translate(m.vertices,n),u>0&&(m.position.x+=n.x,m.position.y+=n.y),n.angle!==0&&(o.rotate(m.vertices,n.angle,i.position),l.rotate(m.axes,n.angle),u>0&&a.rotateAbout(m.position,n.angle,i.position,m.position)),g.update(m.bounds,m.vertices,i.velocity)}n.angle*=e._warming,n.x*=e._warming,n.y*=e._warming}}},e.pointAWorld=function(r){return{x:(r.bodyA?r.bodyA.position.x:0)+(r.pointA?r.pointA.x:0),y:(r.bodyA?r.bodyA.position.y:0)+(r.pointA?r.pointA.y:0)}},e.pointBWorld=function(r){return{x:(r.bodyB?r.bodyB.position.x:0)+(r.pointB?r.pointB.x:0),y:(r.bodyB?r.bodyB.position.y:0)+(r.pointB?r.pointB.y:0)}}})()},function(c,p,h){var e={};c.exports=e;var o=h(2),a=h(0);(function(){e.fromVertices=function(s){for(var g={},l=0;l<s.length;l++){var d=(l+1)%s.length,r=o.normalise({x:s[d].y-s[l].y,y:s[l].x-s[d].x}),t=r.y===0?1/0:r.x/r.y;t=t.toFixed(3).toString(),g[t]=r}return a.values(g)},e.rotate=function(s,g){if(g!==0)for(var l=Math.cos(g),d=Math.sin(g),r=0;r<s.length;r++){var t=s[r],i;i=t.x*l-t.y*d,t.y=t.x*d+t.y*l,t.x=i}}})()},function(c,p,h){var e={};c.exports=e;var o=h(3),a=h(0),s=h(4),g=h(1),l=h(2);(function(){e.rectangle=function(d,r,t,i,n){n=n||{};var u={label:"Rectangle Body",position:{x:d,y:r},vertices:o.fromPath("L 0 0 L "+t+" 0 L "+t+" "+i+" L 0 "+i)};if(n.chamfer){var m=n.chamfer;u.vertices=o.chamfer(u.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete n.chamfer}return s.create(a.extend({},u,n))},e.trapezoid=function(d,r,t,i,n,u){u=u||{},n*=.5;var m=(1-n*2)*t,C=t*n,P=C+m,E=P+C,v;n<.5?v="L 0 0 L "+C+" "+-i+" L "+P+" "+-i+" L "+E+" 0":v="L 0 0 L "+P+" "+-i+" L "+E+" 0";var y={label:"Trapezoid Body",position:{x:d,y:r},vertices:o.fromPath(v)};if(u.chamfer){var w=u.chamfer;y.vertices=o.chamfer(y.vertices,w.radius,w.quality,w.qualityMin,w.qualityMax),delete u.chamfer}return s.create(a.extend({},y,u))},e.circle=function(d,r,t,i,n){i=i||{};var u={label:"Circle Body",circleRadius:t};n=n||25;var m=Math.ceil(Math.max(10,Math.min(n,t)));return m%2===1&&(m+=1),e.polygon(d,r,m,t,a.extend({},u,i))},e.polygon=function(d,r,t,i,n){if(n=n||{},t<3)return e.circle(d,r,i,n);for(var u=2*Math.PI/t,m="",C=u*.5,P=0;P<t;P+=1){var E=C+P*u,v=Math.cos(E)*i,y=Math.sin(E)*i;m+="L "+v.toFixed(3)+" "+y.toFixed(3)+" "}var w={label:"Polygon Body",position:{x:d,y:r},vertices:o.fromPath(m)};if(n.chamfer){var x=n.chamfer;w.vertices=o.chamfer(w.vertices,x.radius,x.quality,x.qualityMin,x.qualityMax),delete n.chamfer}return s.create(a.extend({},w,n))},e.fromVertices=function(d,r,t,i,n,u,m,C){var P=a.getDecomp(),E,v,y,w,x,M,S,I,A,T,k;for(E=!!(P&&P.quickDecomp),i=i||{},y=[],n=typeof n<"u"?n:!1,u=typeof u<"u"?u:.01,m=typeof m<"u"?m:10,C=typeof C<"u"?C:.01,a.isArray(t[0])||(t=[t]),T=0;T<t.length;T+=1)if(M=t[T],w=o.isConvex(M),x=!w,x&&!E&&a.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),w||!E)w?M=o.clockwiseSort(M):M=o.hull(M),y.push({position:{x:d,y:r},vertices:M});else{var L=M.map(function(z){return[z.x,z.y]});P.makeCCW(L),u!==!1&&P.removeCollinearPoints(L,u),C!==!1&&P.removeDuplicatePoints&&P.removeDuplicatePoints(L,C);var R=P.quickDecomp(L);for(S=0;S<R.length;S++){var B=R[S],D=B.map(function(z){return{x:z[0],y:z[1]}});m>0&&o.area(D)<m||y.push({position:o.centre(D),vertices:D})}}for(S=0;S<y.length;S++)y[S]=s.create(a.extend(y[S],i));if(n){var W=5;for(S=0;S<y.length;S++){var O=y[S];for(I=S+1;I<y.length;I++){var b=y[I];if(g.overlaps(O.bounds,b.bounds)){var H=O.vertices,U=b.vertices;for(A=0;A<O.vertices.length;A++)for(k=0;k<b.vertices.length;k++){var V=l.magnitudeSquared(l.sub(H[(A+1)%H.length],U[k])),K=l.magnitudeSquared(l.sub(H[A],U[(k+1)%U.length]));V<W&&K<W&&(H[A].isInternal=!0,U[k].isInternal=!0)}}}}}return y.length>1?(v=s.create(a.extend({parts:y.slice(0)},i)),s.setPosition(v,{x:d,y:r}),v):y[0]}})()},function(c,p,h){var e={};c.exports=e;var o=h(0),a=h(8);(function(){e.create=function(s){var g={bodies:[],pairs:null};return o.extend(g,s)},e.setBodies=function(s,g){s.bodies=g.slice(0)},e.clear=function(s){s.bodies=[]},e.collisions=function(s){var g=[],l=s.pairs,d=s.bodies,r=d.length,t=e.canCollide,i=a.collides,n,u;for(d.sort(e._compareBoundsX),n=0;n<r;n++){var m=d[n],C=m.bounds,P=m.bounds.max.x,E=m.bounds.max.y,v=m.bounds.min.y,y=m.isStatic||m.isSleeping,w=m.parts.length,x=w===1;for(u=n+1;u<r;u++){var M=d[u],S=M.bounds;if(S.min.x>P)break;if(!(E<S.min.y||v>S.max.y)&&!(y&&(M.isStatic||M.isSleeping))&&t(m.collisionFilter,M.collisionFilter)){var I=M.parts.length;if(x&&I===1){var A=i(m,M,l);A&&g.push(A)}else for(var T=w>1?1:0,k=I>1?1:0,L=T;L<w;L++)for(var R=m.parts[L],C=R.bounds,B=k;B<I;B++){var D=M.parts[B],S=D.bounds;if(!(C.min.x>S.max.x||C.max.x<S.min.x||C.max.y<S.min.y||C.min.y>S.max.y)){var A=i(R,D,l);A&&g.push(A)}}}}}return g},e.canCollide=function(s,g){return s.group===g.group&&s.group!==0?s.group>0:(s.mask&g.category)!==0&&(g.mask&s.category)!==0},e._compareBoundsX=function(s,g){return s.bounds.min.x-g.bounds.min.x}})()},function(c,p,h){var e={};c.exports=e;var o=h(0);(function(){e.create=function(a){var s={};return a||o.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=a||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(g){var l=e._getRelativeMousePosition(g,s.element,s.pixelRatio),d=g.changedTouches;d&&(s.button=0,g.preventDefault()),s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=g},s.mousedown=function(g){var l=e._getRelativeMousePosition(g,s.element,s.pixelRatio),d=g.changedTouches;d?(s.button=0,g.preventDefault()):s.button=g.button,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=g},s.mouseup=function(g){var l=e._getRelativeMousePosition(g,s.element,s.pixelRatio),d=g.changedTouches;d&&g.preventDefault(),s.button=-1,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=g},s.mousewheel=function(g){s.wheelDelta=Math.max(-1,Math.min(1,g.wheelDelta||-g.detail)),g.preventDefault()},e.setElement(s,s.element),s},e.setElement=function(a,s){a.element=s,s.addEventListener("mousemove",a.mousemove),s.addEventListener("mousedown",a.mousedown),s.addEventListener("mouseup",a.mouseup),s.addEventListener("mousewheel",a.mousewheel),s.addEventListener("DOMMouseScroll",a.mousewheel),s.addEventListener("touchmove",a.mousemove),s.addEventListener("touchstart",a.mousedown),s.addEventListener("touchend",a.mouseup)},e.clearSourceEvents=function(a){a.sourceEvents.mousemove=null,a.sourceEvents.mousedown=null,a.sourceEvents.mouseup=null,a.sourceEvents.mousewheel=null,a.wheelDelta=0},e.setOffset=function(a,s){a.offset.x=s.x,a.offset.y=s.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},e.setScale=function(a,s){a.scale.x=s.x,a.scale.y=s.y,a.position.x=a.absolute.x*a.scale.x+a.offset.x,a.position.y=a.absolute.y*a.scale.y+a.offset.y},e._getRelativeMousePosition=function(a,s,g){var l=s.getBoundingClientRect(),d=document.documentElement||document.body.parentNode||document.body,r=window.pageXOffset!==void 0?window.pageXOffset:d.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:d.scrollTop,i=a.changedTouches,n,u;return i?(n=i[0].pageX-l.left-r,u=i[0].pageY-l.top-t):(n=a.pageX-l.left-r,u=a.pageY-l.top-t),{x:n/(s.clientWidth/(s.width||s.clientWidth)*g),y:u/(s.clientHeight/(s.height||s.clientHeight)*g)}}})()},function(c,p,h){var e={};c.exports=e;var o=h(0);(function(){e._registry={},e.register=function(a){if(e.isPlugin(a)||o.warn("Plugin.register:",e.toString(a),"does not implement all required fields."),a.name in e._registry){var s=e._registry[a.name],g=e.versionParse(a.version).number,l=e.versionParse(s.version).number;g>l?(o.warn("Plugin.register:",e.toString(s),"was upgraded to",e.toString(a)),e._registry[a.name]=a):g<l?o.warn("Plugin.register:",e.toString(s),"can not be downgraded to",e.toString(a)):a!==s&&o.warn("Plugin.register:",e.toString(a),"is already registered to different plugin object")}else e._registry[a.name]=a;return a},e.resolve=function(a){return e._registry[e.dependencyParse(a).name]},e.toString=function(a){return typeof a=="string"?a:(a.name||"anonymous")+"@"+(a.version||a.range||"0.0.0")},e.isPlugin=function(a){return a&&a.name&&a.version&&a.install},e.isUsed=function(a,s){return a.used.indexOf(s)>-1},e.isFor=function(a,s){var g=a.for&&e.dependencyParse(a.for);return!a.for||s.name===g.name&&e.versionSatisfies(s.version,g.range)},e.use=function(a,s){if(a.uses=(a.uses||[]).concat(s||[]),a.uses.length===0){o.warn("Plugin.use:",e.toString(a),"does not specify any dependencies to install.");return}for(var g=e.dependencies(a),l=o.topologicalSort(g),d=[],r=0;r<l.length;r+=1)if(l[r]!==a.name){var t=e.resolve(l[r]);if(!t){d.push("❌ "+l[r]);continue}e.isUsed(a,t.name)||(e.isFor(t,a)||(o.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(a)+"."),t._warned=!0),t.install?t.install(a):(o.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(d.push("🔶 "+e.toString(t)),delete t._warned):d.push("✅ "+e.toString(t)),a.used.push(t.name))}d.length>0&&o.info(d.join("  "))},e.dependencies=function(a,s){var g=e.dependencyParse(a),l=g.name;if(s=s||{},!(l in s)){a=e.resolve(a)||a,s[l]=o.map(a.uses||[],function(r){e.isPlugin(r)&&e.register(r);var t=e.dependencyParse(r),i=e.resolve(r);return i&&!e.versionSatisfies(i.version,t.range)?(o.warn("Plugin.dependencies:",e.toString(i),"does not satisfy",e.toString(t),"used by",e.toString(g)+"."),i._warned=!0,a._warned=!0):i||(o.warn("Plugin.dependencies:",e.toString(r),"used by",e.toString(g),"could not be resolved."),a._warned=!0),t.name});for(var d=0;d<s[l].length;d+=1)e.dependencies(s[l][d],s);return s}},e.dependencyParse=function(a){if(o.isString(a)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return s.test(a)||o.warn("Plugin.dependencyParse:",a,"is not a valid dependency string."),{name:a.split("@")[0],range:a.split("@")[1]||"*"}}return{name:a.name,range:a.range||a.version}},e.versionParse=function(a){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;s.test(a)||o.warn("Plugin.versionParse:",a,"is not a valid version or range.");var g=s.exec(a),l=Number(g[4]),d=Number(g[5]),r=Number(g[6]);return{isRange:!!(g[1]||g[2]),version:g[3],range:a,operator:g[1]||g[2]||"",major:l,minor:d,patch:r,parts:[l,d,r],prerelease:g[7],number:l*1e8+d*1e4+r}},e.versionSatisfies=function(a,s){s=s||"*";var g=e.versionParse(s),l=e.versionParse(a);if(g.isRange){if(g.operator==="*"||a==="*")return!0;if(g.operator===">")return l.number>g.number;if(g.operator===">=")return l.number>=g.number;if(g.operator==="~")return l.major===g.major&&l.minor===g.minor&&l.patch>=g.patch;if(g.operator==="^")return g.major>0?l.major===g.major&&l.number>=g.number:g.minor>0?l.minor===g.minor&&l.patch>=g.patch:l.patch===g.patch}return a===s||a==="*"}})()},function(c,p){var h={};c.exports=h,function(){h.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}}()},function(c,p,h){var e={};c.exports=e;var o=h(7),a=h(18),s=h(13),g=h(19),l=h(5),d=h(6),r=h(10),t=h(0),i=h(4);(function(){e.create=function(n){n=n||{};var u={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},m=t.extend(u,n);return m.world=n.world||d.create({label:"World"}),m.pairs=n.pairs||g.create(),m.detector=n.detector||s.create(),m.grid={buckets:[]},m.world.gravity=m.gravity,m.broadphase=m.grid,m.metrics={},m},e.update=function(n,u){var m=t.now(),C=n.world,P=n.detector,E=n.pairs,v=n.timing,y=v.timestamp,w;u=typeof u<"u"?u:t._baseDelta,u*=v.timeScale,v.timestamp+=u,v.lastDelta=u;var x={timestamp:v.timestamp,delta:u};l.trigger(n,"beforeUpdate",x);var M=d.allBodies(C),S=d.allConstraints(C);for(C.isModified&&(s.setBodies(P,M),d.setModified(C,!1,!1,!0)),n.enableSleeping&&o.update(M,u),e._bodiesApplyGravity(M,n.gravity),u>0&&e._bodiesUpdate(M,u),r.preSolveAll(M),w=0;w<n.constraintIterations;w++)r.solveAll(S,u);r.postSolveAll(M),P.pairs=n.pairs;var I=s.collisions(P);g.update(E,I,y),n.enableSleeping&&o.afterCollisions(E.list),E.collisionStart.length>0&&l.trigger(n,"collisionStart",{pairs:E.collisionStart});var A=t.clamp(20/n.positionIterations,0,1);for(a.preSolvePosition(E.list),w=0;w<n.positionIterations;w++)a.solvePosition(E.list,u,A);for(a.postSolvePosition(M),r.preSolveAll(M),w=0;w<n.constraintIterations;w++)r.solveAll(S,u);for(r.postSolveAll(M),a.preSolveVelocity(E.list),w=0;w<n.velocityIterations;w++)a.solveVelocity(E.list,u);return e._bodiesUpdateVelocities(M),E.collisionActive.length>0&&l.trigger(n,"collisionActive",{pairs:E.collisionActive}),E.collisionEnd.length>0&&l.trigger(n,"collisionEnd",{pairs:E.collisionEnd}),e._bodiesClearForces(M),l.trigger(n,"afterUpdate",x),n.timing.lastElapsed=t.now()-m,n},e.merge=function(n,u){if(t.extend(n,u),u.world){n.world=u.world,e.clear(n);for(var m=d.allBodies(n.world),C=0;C<m.length;C++){var P=m[C];o.set(P,!1),P.id=t.nextId()}}},e.clear=function(n){g.clear(n.pairs),s.clear(n.detector)},e._bodiesClearForces=function(n){for(var u=n.length,m=0;m<u;m++){var C=n[m];C.force.x=0,C.force.y=0,C.torque=0}},e._bodiesApplyGravity=function(n,u){var m=typeof u.scale<"u"?u.scale:.001,C=n.length;if(!(u.x===0&&u.y===0||m===0))for(var P=0;P<C;P++){var E=n[P];E.isStatic||E.isSleeping||(E.force.y+=E.mass*u.y*m,E.force.x+=E.mass*u.x*m)}},e._bodiesUpdate=function(n,u){for(var m=n.length,C=0;C<m;C++){var P=n[C];P.isStatic||P.isSleeping||i.update(P,u)}},e._bodiesUpdateVelocities=function(n){for(var u=n.length,m=0;m<u;m++)i.updateVelocities(n[m])}})()},function(c,p,h){var e={};c.exports=e;var o=h(3),a=h(0),s=h(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(g){var l,d,r,t=g.length;for(l=0;l<t;l++)d=g[l],d.isActive&&(r=d.activeContacts.length,d.collision.parentA.totalContacts+=r,d.collision.parentB.totalContacts+=r)},e.solvePosition=function(g,l,d){var r,t,i,n,u,m,C,P,E=e._positionDampen*(d||1),v=a.clamp(l/a._baseDelta,0,1),y=g.length;for(r=0;r<y;r++)t=g[r],!(!t.isActive||t.isSensor)&&(i=t.collision,n=i.parentA,u=i.parentB,m=i.normal,t.separation=m.x*(u.positionImpulse.x+i.penetration.x-n.positionImpulse.x)+m.y*(u.positionImpulse.y+i.penetration.y-n.positionImpulse.y));for(r=0;r<y;r++)t=g[r],!(!t.isActive||t.isSensor)&&(i=t.collision,n=i.parentA,u=i.parentB,m=i.normal,P=t.separation-t.slop*v,(n.isStatic||u.isStatic)&&(P*=2),n.isStatic||n.isSleeping||(C=E/n.totalContacts,n.positionImpulse.x+=m.x*P*C,n.positionImpulse.y+=m.y*P*C),u.isStatic||u.isSleeping||(C=E/u.totalContacts,u.positionImpulse.x-=m.x*P*C,u.positionImpulse.y-=m.y*P*C))},e.postSolvePosition=function(g){for(var l=e._positionWarming,d=g.length,r=o.translate,t=s.update,i=0;i<d;i++){var n=g[i],u=n.positionImpulse,m=u.x,C=u.y,P=n.velocity;if(n.totalContacts=0,m!==0||C!==0){for(var E=0;E<n.parts.length;E++){var v=n.parts[E];r(v.vertices,u),t(v.bounds,v.vertices,P),v.position.x+=m,v.position.y+=C}n.positionPrev.x+=m,n.positionPrev.y+=C,m*P.x+C*P.y<0?(u.x=0,u.y=0):(u.x*=l,u.y*=l)}}},e.preSolveVelocity=function(g){var l=g.length,d,r;for(d=0;d<l;d++){var t=g[d];if(!(!t.isActive||t.isSensor)){var i=t.activeContacts,n=i.length,u=t.collision,m=u.parentA,C=u.parentB,P=u.normal,E=u.tangent;for(r=0;r<n;r++){var v=i[r],y=v.vertex,w=v.normalImpulse,x=v.tangentImpulse;if(w!==0||x!==0){var M=P.x*w+E.x*x,S=P.y*w+E.y*x;m.isStatic||m.isSleeping||(m.positionPrev.x+=M*m.inverseMass,m.positionPrev.y+=S*m.inverseMass,m.anglePrev+=m.inverseInertia*((y.x-m.position.x)*S-(y.y-m.position.y)*M)),C.isStatic||C.isSleeping||(C.positionPrev.x-=M*C.inverseMass,C.positionPrev.y-=S*C.inverseMass,C.anglePrev-=C.inverseInertia*((y.x-C.position.x)*S-(y.y-C.position.y)*M))}}}}},e.solveVelocity=function(g,l){var d=l/a._baseDelta,r=d*d,t=r*d,i=-e._restingThresh*d,n=e._restingThreshTangent,u=e._frictionNormalMultiplier*d,m=e._frictionMaxStatic,C=g.length,P,E,v,y;for(v=0;v<C;v++){var w=g[v];if(!(!w.isActive||w.isSensor)){var x=w.collision,M=x.parentA,S=x.parentB,I=M.velocity,A=S.velocity,T=x.normal.x,k=x.normal.y,L=x.tangent.x,R=x.tangent.y,B=w.activeContacts,D=B.length,W=1/D,O=M.inverseMass+S.inverseMass,b=w.friction*w.frictionStatic*u;for(I.x=M.position.x-M.positionPrev.x,I.y=M.position.y-M.positionPrev.y,A.x=S.position.x-S.positionPrev.x,A.y=S.position.y-S.positionPrev.y,M.angularVelocity=M.angle-M.anglePrev,S.angularVelocity=S.angle-S.anglePrev,y=0;y<D;y++){var H=B[y],U=H.vertex,V=U.x-M.position.x,K=U.y-M.position.y,z=U.x-S.position.x,Y=U.y-S.position.y,$=I.x-K*M.angularVelocity,Se=I.y+V*M.angularVelocity,Ce=A.x-Y*S.angularVelocity,Me=A.y+z*S.angularVelocity,oe=$-Ce,le=Se-Me,_=T*oe+k*le,N=L*oe+R*le,he=w.separation+_,ee=Math.min(he,1);ee=he<0?0:ee;var fe=ee*b;N<-fe||N>fe?(E=N>0?N:-N,P=w.friction*(N>0?1:-1)*t,P<-E?P=-E:P>E&&(P=E)):(P=N,E=m);var ce=V*k-K*T,ue=z*k-Y*T,de=W/(O+M.inverseInertia*ce*ce+S.inverseInertia*ue*ue),J=(1+w.restitution)*_*de;if(P*=de,_<i)H.normalImpulse=0;else{var Pe=H.normalImpulse;H.normalImpulse+=J,H.normalImpulse>0&&(H.normalImpulse=0),J=H.normalImpulse-Pe}if(N<-n||N>n)H.tangentImpulse=0;else{var Ee=H.tangentImpulse;H.tangentImpulse+=P,H.tangentImpulse<-E&&(H.tangentImpulse=-E),H.tangentImpulse>E&&(H.tangentImpulse=E),P=H.tangentImpulse-Ee}var j=T*J+L*P,q=k*J+R*P;M.isStatic||M.isSleeping||(M.positionPrev.x+=j*M.inverseMass,M.positionPrev.y+=q*M.inverseMass,M.anglePrev+=(V*q-K*j)*M.inverseInertia),S.isStatic||S.isSleeping||(S.positionPrev.x-=j*S.inverseMass,S.positionPrev.y-=q*S.inverseMass,S.anglePrev-=(z*q-Y*j)*S.inverseInertia)}}}}})()},function(c,p,h){var e={};c.exports=e;var o=h(9),a=h(0);(function(){e.create=function(s){return a.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},e.update=function(s,g,l){var d=s.list,r=d.length,t=s.table,i=g.length,n=s.collisionStart,u=s.collisionEnd,m=s.collisionActive,C,P,E,v;for(n.length=0,u.length=0,m.length=0,v=0;v<r;v++)d[v].confirmedActive=!1;for(v=0;v<i;v++)C=g[v],E=C.pair,E?(E.isActive?m.push(E):n.push(E),o.update(E,C,l),E.confirmedActive=!0):(E=o.create(C,l),t[E.id]=E,n.push(E),d.push(E));var y=[];for(r=d.length,v=0;v<r;v++)E=d[v],E.confirmedActive||(o.setActive(E,!1,l),u.push(E),!E.collision.bodyA.isSleeping&&!E.collision.bodyB.isSleeping&&y.push(v));for(v=0;v<y.length;v++)P=y[v]-v,E=d[P],d.splice(P,1),delete t[E.id]},e.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(c,p,h){var e=c.exports=h(21);e.Axes=h(11),e.Bodies=h(12),e.Body=h(4),e.Bounds=h(1),e.Collision=h(8),e.Common=h(0),e.Composite=h(6),e.Composites=h(22),e.Constraint=h(10),e.Contact=h(16),e.Detector=h(13),e.Engine=h(17),e.Events=h(5),e.Grid=h(23),e.Mouse=h(14),e.MouseConstraint=h(24),e.Pair=h(9),e.Pairs=h(19),e.Plugin=h(15),e.Query=h(25),e.Render=h(26),e.Resolver=h(18),e.Runner=h(27),e.SAT=h(28),e.Sleeping=h(7),e.Svg=h(29),e.Vector=h(2),e.Vertices=h(3),e.World=h(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(c,p,h){var e={};c.exports=e;var o=h(15),a=h(0);(function(){e.name="matter-js",e.version="0.19.0",e.uses=[],e.used=[],e.use=function(){o.use(e,Array.prototype.slice.call(arguments))},e.before=function(s,g){return s=s.replace(/^Matter./,""),a.chainPathBefore(e,s,g)},e.after=function(s,g){return s=s.replace(/^Matter./,""),a.chainPathAfter(e,s,g)}})()},function(c,p,h){var e={};c.exports=e;var o=h(6),a=h(10),s=h(0),g=h(4),l=h(12),d=s.deprecated;(function(){e.stack=function(r,t,i,n,u,m,C){for(var P=o.create({label:"Stack"}),E=r,v=t,y,w=0,x=0;x<n;x++){for(var M=0,S=0;S<i;S++){var I=C(E,v,S,x,y,w);if(I){var A=I.bounds.max.y-I.bounds.min.y,T=I.bounds.max.x-I.bounds.min.x;A>M&&(M=A),g.translate(I,{x:T*.5,y:A*.5}),E=I.bounds.max.x+u,o.addBody(P,I),y=I,w+=1}else E+=u}v+=M+m,E=r}return P},e.chain=function(r,t,i,n,u,m){for(var C=r.bodies,P=1;P<C.length;P++){var E=C[P-1],v=C[P],y=E.bounds.max.y-E.bounds.min.y,w=E.bounds.max.x-E.bounds.min.x,x=v.bounds.max.y-v.bounds.min.y,M=v.bounds.max.x-v.bounds.min.x,S={bodyA:E,pointA:{x:w*t,y:y*i},bodyB:v,pointB:{x:M*n,y:x*u}},I=s.extend(S,m);o.addConstraint(r,a.create(I))}return r.label+=" Chain",r},e.mesh=function(r,t,i,n,u){var m=r.bodies,C,P,E,v,y;for(C=0;C<i;C++){for(P=1;P<t;P++)E=m[P-1+C*t],v=m[P+C*t],o.addConstraint(r,a.create(s.extend({bodyA:E,bodyB:v},u)));if(C>0)for(P=0;P<t;P++)E=m[P+(C-1)*t],v=m[P+C*t],o.addConstraint(r,a.create(s.extend({bodyA:E,bodyB:v},u))),n&&P>0&&(y=m[P-1+(C-1)*t],o.addConstraint(r,a.create(s.extend({bodyA:y,bodyB:v},u)))),n&&P<t-1&&(y=m[P+1+(C-1)*t],o.addConstraint(r,a.create(s.extend({bodyA:y,bodyB:v},u))))}return r.label+=" Mesh",r},e.pyramid=function(r,t,i,n,u,m,C){return e.stack(r,t,i,n,u,m,function(P,E,v,y,w,x){var M=Math.min(n,Math.ceil(i/2)),S=w?w.bounds.max.x-w.bounds.min.x:0;if(!(y>M)){y=M-y;var I=y,A=i-1-y;if(!(v<I||v>A)){x===1&&g.translate(w,{x:(v+(i%2===1?1:-1))*S,y:0});var T=w?v*S:0;return C(r+T+v*u,E,v,y,w,x)}}})},e.newtonsCradle=function(r,t,i,n,u){for(var m=o.create({label:"Newtons Cradle"}),C=0;C<i;C++){var P=1.9,E=l.circle(r+C*(n*P),t+u,n,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),v=a.create({pointA:{x:r+C*(n*P),y:t},bodyB:E});o.addBody(m,E),o.addConstraint(m,v)}return m},d(e,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),e.car=function(r,t,i,n,u){var m=g.nextGroup(!0),C=20,P=-i*.5+C,E=i*.5-C,v=0,y=o.create({label:"Car"}),w=l.rectangle(r,t,i,n,{collisionFilter:{group:m},chamfer:{radius:n*.5},density:2e-4}),x=l.circle(r+P,t+v,u,{collisionFilter:{group:m},friction:.8}),M=l.circle(r+E,t+v,u,{collisionFilter:{group:m},friction:.8}),S=a.create({bodyB:w,pointB:{x:P,y:v},bodyA:x,stiffness:1,length:0}),I=a.create({bodyB:w,pointB:{x:E,y:v},bodyA:M,stiffness:1,length:0});return o.addBody(y,w),o.addBody(y,x),o.addBody(y,M),o.addConstraint(y,S),o.addConstraint(y,I),y},d(e,"car","Composites.car ➤ moved to car example"),e.softBody=function(r,t,i,n,u,m,C,P,E,v){E=s.extend({inertia:1/0},E),v=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},v);var y=e.stack(r,t,i,n,u,m,function(w,x){return l.circle(w,x,P,E)});return e.mesh(y,i,n,C,v),y.label="Soft Body",y},d(e,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(c,p,h){var e={};c.exports=e;var o=h(9),a=h(0),s=a.deprecated;(function(){e.create=function(g){var l={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return a.extend(l,g)},e.update=function(g,l,d,r){var t,i,n,u=d.world,m=g.buckets,C,P,E=!1;for(t=0;t<l.length;t++){var v=l[t];if(!(v.isSleeping&&!r)&&!(u.bounds&&(v.bounds.max.x<u.bounds.min.x||v.bounds.min.x>u.bounds.max.x||v.bounds.max.y<u.bounds.min.y||v.bounds.min.y>u.bounds.max.y))){var y=e._getRegion(g,v);if(!v.region||y.id!==v.region.id||r){(!v.region||r)&&(v.region=y);var w=e._regionUnion(y,v.region);for(i=w.startCol;i<=w.endCol;i++)for(n=w.startRow;n<=w.endRow;n++){P=e._getBucketId(i,n),C=m[P];var x=i>=y.startCol&&i<=y.endCol&&n>=y.startRow&&n<=y.endRow,M=i>=v.region.startCol&&i<=v.region.endCol&&n>=v.region.startRow&&n<=v.region.endRow;!x&&M&&M&&C&&e._bucketRemoveBody(g,C,v),(v.region===y||x&&!M||r)&&(C||(C=e._createBucket(m,P)),e._bucketAddBody(g,C,v))}v.region=y,E=!0}}}E&&(g.pairsList=e._createActivePairsList(g))},s(e,"update","Grid.update ➤ replaced by Matter.Detector"),e.clear=function(g){g.buckets={},g.pairs={},g.pairsList=[]},s(e,"clear","Grid.clear ➤ replaced by Matter.Detector"),e._regionUnion=function(g,l){var d=Math.min(g.startCol,l.startCol),r=Math.max(g.endCol,l.endCol),t=Math.min(g.startRow,l.startRow),i=Math.max(g.endRow,l.endRow);return e._createRegion(d,r,t,i)},e._getRegion=function(g,l){var d=l.bounds,r=Math.floor(d.min.x/g.bucketWidth),t=Math.floor(d.max.x/g.bucketWidth),i=Math.floor(d.min.y/g.bucketHeight),n=Math.floor(d.max.y/g.bucketHeight);return e._createRegion(r,t,i,n)},e._createRegion=function(g,l,d,r){return{id:g+","+l+","+d+","+r,startCol:g,endCol:l,startRow:d,endRow:r}},e._getBucketId=function(g,l){return"C"+g+"R"+l},e._createBucket=function(g,l){var d=g[l]=[];return d},e._bucketAddBody=function(g,l,d){var r=g.pairs,t=o.id,i=l.length,n;for(n=0;n<i;n++){var u=l[n];if(!(d.id===u.id||d.isStatic&&u.isStatic)){var m=t(d,u),C=r[m];C?C[2]+=1:r[m]=[d,u,1]}}l.push(d)},e._bucketRemoveBody=function(g,l,d){var r=g.pairs,t=o.id,i;l.splice(a.indexOf(l,d),1);var n=l.length;for(i=0;i<n;i++){var u=r[t(d,l[i])];u&&(u[2]-=1)}},e._createActivePairsList=function(g){var l,d=g.pairs,r=a.keys(d),t=r.length,i=[],n;for(n=0;n<t;n++)l=d[r[n]],l[2]>0?i.push(l):delete d[r[n]];return i}})()},function(c,p,h){var e={};c.exports=e;var o=h(3),a=h(7),s=h(14),g=h(5),l=h(13),d=h(10),r=h(6),t=h(0),i=h(1);(function(){e.create=function(n,u){var m=(n?n.mouse:null)||(u?u.mouse:null);m||(n&&n.render&&n.render.canvas?m=s.create(n.render.canvas):u&&u.element?m=s.create(u.element):(m=s.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var C=d.create({label:"Mouse Constraint",pointA:m.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),P={type:"mouseConstraint",mouse:m,element:null,body:null,constraint:C,collisionFilter:{category:1,mask:4294967295,group:0}},E=t.extend(P,u);return g.on(n,"beforeUpdate",function(){var v=r.allBodies(n.world);e.update(E,v),e._triggerEvents(E)}),E},e.update=function(n,u){var m=n.mouse,C=n.constraint,P=n.body;if(m.button===0){if(C.bodyB)a.set(C.bodyB,!1),C.pointA=m.position;else for(var E=0;E<u.length;E++)if(P=u[E],i.contains(P.bounds,m.position)&&l.canCollide(P.collisionFilter,n.collisionFilter))for(var v=P.parts.length>1?1:0;v<P.parts.length;v++){var y=P.parts[v];if(o.contains(y.vertices,m.position)){C.pointA=m.position,C.bodyB=n.body=P,C.pointB={x:m.position.x-P.position.x,y:m.position.y-P.position.y},C.angleB=P.angle,a.set(P,!1),g.trigger(n,"startdrag",{mouse:m,body:P});break}}}else C.bodyB=n.body=null,C.pointB=null,P&&g.trigger(n,"enddrag",{mouse:m,body:P})},e._triggerEvents=function(n){var u=n.mouse,m=u.sourceEvents;m.mousemove&&g.trigger(n,"mousemove",{mouse:u}),m.mousedown&&g.trigger(n,"mousedown",{mouse:u}),m.mouseup&&g.trigger(n,"mouseup",{mouse:u}),s.clearSourceEvents(u)}})()},function(c,p,h){var e={};c.exports=e;var o=h(2),a=h(8),s=h(1),g=h(12),l=h(3);(function(){e.collides=function(d,r){for(var t=[],i=r.length,n=d.bounds,u=a.collides,m=s.overlaps,C=0;C<i;C++){var P=r[C],E=P.parts.length,v=E===1?0:1;if(m(P.bounds,n))for(var y=v;y<E;y++){var w=P.parts[y];if(m(w.bounds,n)){var x=u(w,d);if(x){t.push(x);break}}}}return t},e.ray=function(d,r,t,i){i=i||1e-100;for(var n=o.angle(r,t),u=o.magnitude(o.sub(r,t)),m=(t.x+r.x)*.5,C=(t.y+r.y)*.5,P=g.rectangle(m,C,u,i,{angle:n}),E=e.collides(P,d),v=0;v<E.length;v+=1){var y=E[v];y.body=y.bodyB=y.bodyA}return E},e.region=function(d,r,t){for(var i=[],n=0;n<d.length;n++){var u=d[n],m=s.overlaps(u.bounds,r);(m&&!t||!m&&t)&&i.push(u)}return i},e.point=function(d,r){for(var t=[],i=0;i<d.length;i++){var n=d[i];if(s.contains(n.bounds,r))for(var u=n.parts.length===1?0:1;u<n.parts.length;u++){var m=n.parts[u];if(s.contains(m.bounds,r)&&l.contains(m.vertices,r)){t.push(n);break}}}return t}})()},function(c,p,h){var e={};c.exports=e;var o=h(4),a=h(0),s=h(6),g=h(1),l=h(5),d=h(2),r=h(14);(function(){var t,i;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(v){window.setTimeout(function(){v(a.now())},1e3/60)},i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(v){var y={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!v.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},w=a.extend(y,v);return w.canvas&&(w.canvas.width=w.options.width||w.canvas.width,w.canvas.height=w.options.height||w.canvas.height),w.mouse=v.mouse,w.engine=v.engine,w.canvas=w.canvas||m(w.options.width,w.options.height),w.context=w.canvas.getContext("2d"),w.textures={},w.bounds=w.bounds||{min:{x:0,y:0},max:{x:w.canvas.width,y:w.canvas.height}},w.controller=e,w.options.showBroadphase=!1,w.options.pixelRatio!==1&&e.setPixelRatio(w,w.options.pixelRatio),a.isElement(w.element)&&w.element.appendChild(w.canvas),w},e.run=function(v){(function y(w){v.frameRequestId=t(y),n(v,w),e.world(v,w),(v.options.showStats||v.options.showDebug)&&e.stats(v,v.context,w),(v.options.showPerformance||v.options.showDebug)&&e.performance(v,v.context,w)})()},e.stop=function(v){i(v.frameRequestId)},e.setPixelRatio=function(v,y){var w=v.options,x=v.canvas;y==="auto"&&(y=C(x)),w.pixelRatio=y,x.setAttribute("data-pixel-ratio",y),x.width=w.width*y,x.height=w.height*y,x.style.width=w.width+"px",x.style.height=w.height+"px"},e.lookAt=function(v,y,w,x){x=typeof x<"u"?x:!0,y=a.isArray(y)?y:[y],w=w||{x:0,y:0};for(var M={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},S=0;S<y.length;S+=1){var I=y[S],A=I.bounds?I.bounds.min:I.min||I.position||I,T=I.bounds?I.bounds.max:I.max||I.position||I;A&&T&&(A.x<M.min.x&&(M.min.x=A.x),T.x>M.max.x&&(M.max.x=T.x),A.y<M.min.y&&(M.min.y=A.y),T.y>M.max.y&&(M.max.y=T.y))}var k=M.max.x-M.min.x+2*w.x,L=M.max.y-M.min.y+2*w.y,R=v.canvas.height,B=v.canvas.width,D=B/R,W=k/L,O=1,b=1;W>D?b=W/D:O=D/W,v.options.hasBounds=!0,v.bounds.min.x=M.min.x,v.bounds.max.x=M.min.x+k*O,v.bounds.min.y=M.min.y,v.bounds.max.y=M.min.y+L*b,x&&(v.bounds.min.x+=k*.5-k*O*.5,v.bounds.max.x+=k*.5-k*O*.5,v.bounds.min.y+=L*.5-L*b*.5,v.bounds.max.y+=L*.5-L*b*.5),v.bounds.min.x-=w.x,v.bounds.max.x-=w.x,v.bounds.min.y-=w.y,v.bounds.max.y-=w.y,v.mouse&&(r.setScale(v.mouse,{x:(v.bounds.max.x-v.bounds.min.x)/v.canvas.width,y:(v.bounds.max.y-v.bounds.min.y)/v.canvas.height}),r.setOffset(v.mouse,v.bounds.min))},e.startViewTransform=function(v){var y=v.bounds.max.x-v.bounds.min.x,w=v.bounds.max.y-v.bounds.min.y,x=y/v.options.width,M=w/v.options.height;v.context.setTransform(v.options.pixelRatio/x,0,0,v.options.pixelRatio/M,0,0),v.context.translate(-v.bounds.min.x,-v.bounds.min.y)},e.endViewTransform=function(v){v.context.setTransform(v.options.pixelRatio,0,0,v.options.pixelRatio,0,0)},e.world=function(v,y){var w=a.now(),x=v.engine,M=x.world,S=v.canvas,I=v.context,A=v.options,T=v.timing,k=s.allBodies(M),L=s.allConstraints(M),R=A.wireframes?A.wireframeBackground:A.background,B=[],D=[],W,O={timestamp:x.timing.timestamp};if(l.trigger(v,"beforeRender",O),v.currentBackground!==R&&E(v,R),I.globalCompositeOperation="source-in",I.fillStyle="transparent",I.fillRect(0,0,S.width,S.height),I.globalCompositeOperation="source-over",A.hasBounds){for(W=0;W<k.length;W++){var b=k[W];g.overlaps(b.bounds,v.bounds)&&B.push(b)}for(W=0;W<L.length;W++){var H=L[W],U=H.bodyA,V=H.bodyB,K=H.pointA,z=H.pointB;U&&(K=d.add(U.position,H.pointA)),V&&(z=d.add(V.position,H.pointB)),!(!K||!z)&&(g.contains(v.bounds,K)||g.contains(v.bounds,z))&&D.push(H)}e.startViewTransform(v),v.mouse&&(r.setScale(v.mouse,{x:(v.bounds.max.x-v.bounds.min.x)/v.options.width,y:(v.bounds.max.y-v.bounds.min.y)/v.options.height}),r.setOffset(v.mouse,v.bounds.min))}else D=L,B=k,v.options.pixelRatio!==1&&v.context.setTransform(v.options.pixelRatio,0,0,v.options.pixelRatio,0,0);!A.wireframes||x.enableSleeping&&A.showSleeping?e.bodies(v,B,I):(A.showConvexHulls&&e.bodyConvexHulls(v,B,I),e.bodyWireframes(v,B,I)),A.showBounds&&e.bodyBounds(v,B,I),(A.showAxes||A.showAngleIndicator)&&e.bodyAxes(v,B,I),A.showPositions&&e.bodyPositions(v,B,I),A.showVelocity&&e.bodyVelocity(v,B,I),A.showIds&&e.bodyIds(v,B,I),A.showSeparations&&e.separations(v,x.pairs.list,I),A.showCollisions&&e.collisions(v,x.pairs.list,I),A.showVertexNumbers&&e.vertexNumbers(v,B,I),A.showMousePosition&&e.mousePosition(v,v.mouse,I),e.constraints(D,I),A.hasBounds&&e.endViewTransform(v),l.trigger(v,"afterRender",O),T.lastElapsed=a.now()-w},e.stats=function(v,y,w){for(var x=v.engine,M=x.world,S=s.allBodies(M),I=0,A=55,T=44,k=0,L=0,R=0;R<S.length;R+=1)I+=S[R].parts.length;var B={Part:I,Body:S.length,Cons:s.allConstraints(M).length,Comp:s.allComposites(M).length,Pair:x.pairs.list.length};y.fillStyle="#0e0f19",y.fillRect(k,L,A*5.5,T),y.font="12px Arial",y.textBaseline="top",y.textAlign="right";for(var D in B){var W=B[D];y.fillStyle="#aaa",y.fillText(D,k+A,L+8),y.fillStyle="#eee",y.fillText(W,k+A,L+26),k+=A}},e.performance=function(v,y){var w=v.engine,x=v.timing,M=x.deltaHistory,S=x.elapsedHistory,I=x.timestampElapsedHistory,A=x.engineDeltaHistory,T=x.engineElapsedHistory,k=w.timing.lastDelta,L=u(M),R=u(S),B=u(A),D=u(T),W=u(I),O=W/L||0,b=1e3/L||0,H=4,U=12,V=60,K=34,z=10,Y=69;y.fillStyle="#0e0f19",y.fillRect(0,50,U*4+V*5+22,K),e.status(y,z,Y,V,H,M.length,Math.round(b)+" fps",b/e._goodFps,function($){return M[$]/L-1}),e.status(y,z+U+V,Y,V,H,A.length,k.toFixed(2)+" dt",e._goodDelta/k,function($){return A[$]/B-1}),e.status(y,z+(U+V)*2,Y,V,H,T.length,D.toFixed(2)+" ut",1-D/e._goodFps,function($){return T[$]/D-1}),e.status(y,z+(U+V)*3,Y,V,H,S.length,R.toFixed(2)+" rt",1-R/e._goodFps,function($){return S[$]/R-1}),e.status(y,z+(U+V)*4,Y,V,H,I.length,O.toFixed(2)+" x",O*O*O,function($){return(I[$]/M[$]/O||0)-1})},e.status=function(v,y,w,x,M,S,I,A,T){v.strokeStyle="#888",v.fillStyle="#444",v.lineWidth=1,v.fillRect(y,w+7,x,1),v.beginPath(),v.moveTo(y,w+7-M*a.clamp(.4*T(0),-2,2));for(var k=0;k<x;k+=1)v.lineTo(y+k,w+7-(k<S?M*a.clamp(.4*T(k),-2,2):0));v.stroke(),v.fillStyle="hsl("+a.clamp(25+95*A,0,120)+",100%,60%)",v.fillRect(y,w-7,4,4),v.font="12px Arial",v.textBaseline="middle",v.textAlign="right",v.fillStyle="#eee",v.fillText(I,y+x,w-5)},e.constraints=function(v,y){for(var w=y,x=0;x<v.length;x++){var M=v[x];if(!(!M.render.visible||!M.pointA||!M.pointB)){var S=M.bodyA,I=M.bodyB,A,T;if(S?A=d.add(S.position,M.pointA):A=M.pointA,M.render.type==="pin")w.beginPath(),w.arc(A.x,A.y,3,0,2*Math.PI),w.closePath();else{if(I?T=d.add(I.position,M.pointB):T=M.pointB,w.beginPath(),w.moveTo(A.x,A.y),M.render.type==="spring")for(var k=d.sub(T,A),L=d.perp(d.normalise(k)),R=Math.ceil(a.clamp(M.length/5,12,20)),B,D=1;D<R;D+=1)B=D%2===0?1:-1,w.lineTo(A.x+k.x*(D/R)+L.x*B*4,A.y+k.y*(D/R)+L.y*B*4);w.lineTo(T.x,T.y)}M.render.lineWidth&&(w.lineWidth=M.render.lineWidth,w.strokeStyle=M.render.strokeStyle,w.stroke()),M.render.anchors&&(w.fillStyle=M.render.strokeStyle,w.beginPath(),w.arc(A.x,A.y,3,0,2*Math.PI),w.arc(T.x,T.y,3,0,2*Math.PI),w.closePath(),w.fill())}}},e.bodies=function(v,y,w){var x=w;v.engine;var M=v.options,S=M.showInternalEdges||!M.wireframes,I,A,T,k;for(T=0;T<y.length;T++)if(I=y[T],!!I.render.visible){for(k=I.parts.length>1?1:0;k<I.parts.length;k++)if(A=I.parts[k],!!A.render.visible){if(M.showSleeping&&I.isSleeping?x.globalAlpha=.5*A.render.opacity:A.render.opacity!==1&&(x.globalAlpha=A.render.opacity),A.render.sprite&&A.render.sprite.texture&&!M.wireframes){var L=A.render.sprite,R=P(v,L.texture);x.translate(A.position.x,A.position.y),x.rotate(A.angle),x.drawImage(R,R.width*-L.xOffset*L.xScale,R.height*-L.yOffset*L.yScale,R.width*L.xScale,R.height*L.yScale),x.rotate(-A.angle),x.translate(-A.position.x,-A.position.y)}else{if(A.circleRadius)x.beginPath(),x.arc(A.position.x,A.position.y,A.circleRadius,0,2*Math.PI);else{x.beginPath(),x.moveTo(A.vertices[0].x,A.vertices[0].y);for(var B=1;B<A.vertices.length;B++)!A.vertices[B-1].isInternal||S?x.lineTo(A.vertices[B].x,A.vertices[B].y):x.moveTo(A.vertices[B].x,A.vertices[B].y),A.vertices[B].isInternal&&!S&&x.moveTo(A.vertices[(B+1)%A.vertices.length].x,A.vertices[(B+1)%A.vertices.length].y);x.lineTo(A.vertices[0].x,A.vertices[0].y),x.closePath()}M.wireframes?(x.lineWidth=1,x.strokeStyle="#bbb",x.stroke()):(x.fillStyle=A.render.fillStyle,A.render.lineWidth&&(x.lineWidth=A.render.lineWidth,x.strokeStyle=A.render.strokeStyle,x.stroke()),x.fill())}x.globalAlpha=1}}},e.bodyWireframes=function(v,y,w){var x=w,M=v.options.showInternalEdges,S,I,A,T,k;for(x.beginPath(),A=0;A<y.length;A++)if(S=y[A],!!S.render.visible)for(k=S.parts.length>1?1:0;k<S.parts.length;k++){for(I=S.parts[k],x.moveTo(I.vertices[0].x,I.vertices[0].y),T=1;T<I.vertices.length;T++)!I.vertices[T-1].isInternal||M?x.lineTo(I.vertices[T].x,I.vertices[T].y):x.moveTo(I.vertices[T].x,I.vertices[T].y),I.vertices[T].isInternal&&!M&&x.moveTo(I.vertices[(T+1)%I.vertices.length].x,I.vertices[(T+1)%I.vertices.length].y);x.lineTo(I.vertices[0].x,I.vertices[0].y)}x.lineWidth=1,x.strokeStyle="#bbb",x.stroke()},e.bodyConvexHulls=function(v,y,w){var x=w,M,S,I;for(x.beginPath(),S=0;S<y.length;S++)if(M=y[S],!(!M.render.visible||M.parts.length===1)){for(x.moveTo(M.vertices[0].x,M.vertices[0].y),I=1;I<M.vertices.length;I++)x.lineTo(M.vertices[I].x,M.vertices[I].y);x.lineTo(M.vertices[0].x,M.vertices[0].y)}x.lineWidth=1,x.strokeStyle="rgba(255,255,255,0.2)",x.stroke()},e.vertexNumbers=function(v,y,w){var x=w,M,S,I;for(M=0;M<y.length;M++){var A=y[M].parts;for(I=A.length>1?1:0;I<A.length;I++){var T=A[I];for(S=0;S<T.vertices.length;S++)x.fillStyle="rgba(255,255,255,0.2)",x.fillText(M+"_"+S,T.position.x+(T.vertices[S].x-T.position.x)*.8,T.position.y+(T.vertices[S].y-T.position.y)*.8)}}},e.mousePosition=function(v,y,w){var x=w;x.fillStyle="rgba(255,255,255,0.8)",x.fillText(y.position.x+"  "+y.position.y,y.position.x+5,y.position.y-5)},e.bodyBounds=function(v,y,w){var x=w;v.engine;var M=v.options;x.beginPath();for(var S=0;S<y.length;S++){var I=y[S];if(I.render.visible)for(var A=y[S].parts,T=A.length>1?1:0;T<A.length;T++){var k=A[T];x.rect(k.bounds.min.x,k.bounds.min.y,k.bounds.max.x-k.bounds.min.x,k.bounds.max.y-k.bounds.min.y)}}M.wireframes?x.strokeStyle="rgba(255,255,255,0.08)":x.strokeStyle="rgba(0,0,0,0.1)",x.lineWidth=1,x.stroke()},e.bodyAxes=function(v,y,w){var x=w;v.engine;var M=v.options,S,I,A,T;for(x.beginPath(),I=0;I<y.length;I++){var k=y[I],L=k.parts;if(k.render.visible)if(M.showAxes)for(A=L.length>1?1:0;A<L.length;A++)for(S=L[A],T=0;T<S.axes.length;T++){var R=S.axes[T];x.moveTo(S.position.x,S.position.y),x.lineTo(S.position.x+R.x*20,S.position.y+R.y*20)}else for(A=L.length>1?1:0;A<L.length;A++)for(S=L[A],T=0;T<S.axes.length;T++)x.moveTo(S.position.x,S.position.y),x.lineTo((S.vertices[0].x+S.vertices[S.vertices.length-1].x)/2,(S.vertices[0].y+S.vertices[S.vertices.length-1].y)/2)}M.wireframes?(x.strokeStyle="indianred",x.lineWidth=1):(x.strokeStyle="rgba(255, 255, 255, 0.4)",x.globalCompositeOperation="overlay",x.lineWidth=2),x.stroke(),x.globalCompositeOperation="source-over"},e.bodyPositions=function(v,y,w){var x=w;v.engine;var M=v.options,S,I,A,T;for(x.beginPath(),A=0;A<y.length;A++)if(S=y[A],!!S.render.visible)for(T=0;T<S.parts.length;T++)I=S.parts[T],x.arc(I.position.x,I.position.y,3,0,2*Math.PI,!1),x.closePath();for(M.wireframes?x.fillStyle="indianred":x.fillStyle="rgba(0,0,0,0.5)",x.fill(),x.beginPath(),A=0;A<y.length;A++)S=y[A],S.render.visible&&(x.arc(S.positionPrev.x,S.positionPrev.y,2,0,2*Math.PI,!1),x.closePath());x.fillStyle="rgba(255,165,0,0.8)",x.fill()},e.bodyVelocity=function(v,y,w){var x=w;x.beginPath();for(var M=0;M<y.length;M++){var S=y[M];if(S.render.visible){var I=o.getVelocity(S);x.moveTo(S.position.x,S.position.y),x.lineTo(S.position.x+I.x,S.position.y+I.y)}}x.lineWidth=3,x.strokeStyle="cornflowerblue",x.stroke()},e.bodyIds=function(v,y,w){var x=w,M,S;for(M=0;M<y.length;M++)if(y[M].render.visible){var I=y[M].parts;for(S=I.length>1?1:0;S<I.length;S++){var A=I[S];x.font="12px Arial",x.fillStyle="rgba(255,255,255,0.5)",x.fillText(A.id,A.position.x+10,A.position.y-10)}}},e.collisions=function(v,y,w){var x=w,M=v.options,S,I,A,T;for(x.beginPath(),A=0;A<y.length;A++)if(S=y[A],!!S.isActive)for(I=S.collision,T=0;T<S.activeContacts.length;T++){var k=S.activeContacts[T],L=k.vertex;x.rect(L.x-1.5,L.y-1.5,3.5,3.5)}for(M.wireframes?x.fillStyle="rgba(255,255,255,0.7)":x.fillStyle="orange",x.fill(),x.beginPath(),A=0;A<y.length;A++)if(S=y[A],!!S.isActive&&(I=S.collision,S.activeContacts.length>0)){var R=S.activeContacts[0].vertex.x,B=S.activeContacts[0].vertex.y;S.activeContacts.length===2&&(R=(S.activeContacts[0].vertex.x+S.activeContacts[1].vertex.x)/2,B=(S.activeContacts[0].vertex.y+S.activeContacts[1].vertex.y)/2),I.bodyB===I.supports[0].body||I.bodyA.isStatic===!0?x.moveTo(R-I.normal.x*8,B-I.normal.y*8):x.moveTo(R+I.normal.x*8,B+I.normal.y*8),x.lineTo(R,B)}M.wireframes?x.strokeStyle="rgba(255,165,0,0.7)":x.strokeStyle="orange",x.lineWidth=1,x.stroke()},e.separations=function(v,y,w){var x=w,M=v.options,S,I,A,T,k;for(x.beginPath(),k=0;k<y.length;k++)if(S=y[k],!!S.isActive){I=S.collision,A=I.bodyA,T=I.bodyB;var L=1;!T.isStatic&&!A.isStatic&&(L=.5),T.isStatic&&(L=0),x.moveTo(T.position.x,T.position.y),x.lineTo(T.position.x-I.penetration.x*L,T.position.y-I.penetration.y*L),L=1,!T.isStatic&&!A.isStatic&&(L=.5),A.isStatic&&(L=0),x.moveTo(A.position.x,A.position.y),x.lineTo(A.position.x+I.penetration.x*L,A.position.y+I.penetration.y*L)}M.wireframes?x.strokeStyle="rgba(255,165,0,0.5)":x.strokeStyle="orange",x.stroke()},e.inspector=function(v,y){v.engine;var w=v.selected,x=v.render,M=x.options,S;if(M.hasBounds){var I=x.bounds.max.x-x.bounds.min.x,A=x.bounds.max.y-x.bounds.min.y,T=I/x.options.width,k=A/x.options.height;y.scale(1/T,1/k),y.translate(-x.bounds.min.x,-x.bounds.min.y)}for(var L=0;L<w.length;L++){var R=w[L].data;switch(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.9)",y.setLineDash([1,2]),R.type){case"body":S=R.bounds,y.beginPath(),y.rect(Math.floor(S.min.x-3),Math.floor(S.min.y-3),Math.floor(S.max.x-S.min.x+6),Math.floor(S.max.y-S.min.y+6)),y.closePath(),y.stroke();break;case"constraint":var B=R.pointA;R.bodyA&&(B=R.pointB),y.beginPath(),y.arc(B.x,B.y,10,0,2*Math.PI),y.closePath(),y.stroke();break}y.setLineDash([]),y.translate(-.5,-.5)}v.selectStart!==null&&(y.translate(.5,.5),y.lineWidth=1,y.strokeStyle="rgba(255,165,0,0.6)",y.fillStyle="rgba(255,165,0,0.1)",S=v.selectBounds,y.beginPath(),y.rect(Math.floor(S.min.x),Math.floor(S.min.y),Math.floor(S.max.x-S.min.x),Math.floor(S.max.y-S.min.y)),y.closePath(),y.stroke(),y.fill(),y.translate(-.5,-.5)),M.hasBounds&&y.setTransform(1,0,0,1,0,0)};var n=function(v,y){var w=v.engine,x=v.timing,M=x.historySize,S=w.timing.timestamp;x.delta=y-x.lastTime||e._goodDelta,x.lastTime=y,x.timestampElapsed=S-x.lastTimestamp||0,x.lastTimestamp=S,x.deltaHistory.unshift(x.delta),x.deltaHistory.length=Math.min(x.deltaHistory.length,M),x.engineDeltaHistory.unshift(w.timing.lastDelta),x.engineDeltaHistory.length=Math.min(x.engineDeltaHistory.length,M),x.timestampElapsedHistory.unshift(x.timestampElapsed),x.timestampElapsedHistory.length=Math.min(x.timestampElapsedHistory.length,M),x.engineElapsedHistory.unshift(w.timing.lastElapsed),x.engineElapsedHistory.length=Math.min(x.engineElapsedHistory.length,M),x.elapsedHistory.unshift(x.lastElapsed),x.elapsedHistory.length=Math.min(x.elapsedHistory.length,M)},u=function(v){for(var y=0,w=0;w<v.length;w+=1)y+=v[w];return y/v.length||0},m=function(v,y){var w=document.createElement("canvas");return w.width=v,w.height=y,w.oncontextmenu=function(){return!1},w.onselectstart=function(){return!1},w},C=function(v){var y=v.getContext("2d"),w=window.devicePixelRatio||1,x=y.webkitBackingStorePixelRatio||y.mozBackingStorePixelRatio||y.msBackingStorePixelRatio||y.oBackingStorePixelRatio||y.backingStorePixelRatio||1;return w/x},P=function(v,y){var w=v.textures[y];return w||(w=v.textures[y]=new Image,w.src=y,w)},E=function(v,y){var w=y;/(jpg|gif|png)$/.test(y)&&(w="url("+y+")"),v.canvas.style.background=w,v.canvas.style.backgroundSize="contain",v.currentBackground=y}})()},function(c,p,h){var e={};c.exports=e;var o=h(5),a=h(17),s=h(0);(function(){var g,l;if(typeof window<"u"&&(g=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!g){var d;g=function(r){d=setTimeout(function(){r(s.now())},1e3/60)},l=function(){clearTimeout(d)}}e.create=function(r){var t={fps:60,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,frameRequestId:null,isFixed:!1,enabled:!0},i=s.extend(t,r);return i.delta=i.delta||1e3/i.fps,i.deltaMin=i.deltaMin||1e3/i.fps,i.deltaMax=i.deltaMax||1e3/(i.fps*.5),i.fps=1e3/i.delta,i},e.run=function(r,t){return typeof r.positionIterations<"u"&&(t=r,r=e.create()),function i(n){r.frameRequestId=g(i),n&&r.enabled&&e.tick(r,t,n)}(),r},e.tick=function(r,t,i){var n=t.timing,u;r.isFixed?u=r.delta:(u=i-r.timePrev||r.delta,r.timePrev=i,r.deltaHistory.push(u),r.deltaHistory=r.deltaHistory.slice(-r.deltaSampleSize),u=Math.min.apply(null,r.deltaHistory),u=u<r.deltaMin?r.deltaMin:u,u=u>r.deltaMax?r.deltaMax:u,r.delta=u);var m={timestamp:n.timestamp};o.trigger(r,"beforeTick",m),r.frameCounter+=1,i-r.counterTimestamp>=1e3&&(r.fps=r.frameCounter*((i-r.counterTimestamp)/1e3),r.counterTimestamp=i,r.frameCounter=0),o.trigger(r,"tick",m),o.trigger(r,"beforeUpdate",m),a.update(t,u),o.trigger(r,"afterUpdate",m),o.trigger(r,"afterTick",m)},e.stop=function(r){l(r.frameRequestId)},e.start=function(r,t){e.run(r,t)}})()},function(c,p,h){var e={};c.exports=e;var o=h(8),a=h(0),s=a.deprecated;(function(){e.collides=function(g,l){return o.collides(g,l)},s(e,"collides","SAT.collides ➤ replaced by Collision.collides")})()},function(c,p,h){var e={};c.exports=e,h(1);var o=h(0);(function(){e.pathToVertices=function(a,s){typeof window<"u"&&!("SVGPathSeg"in window)&&o.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var g,l,d,r,t,i,n,u,m,C,P=[],E,v,y=0,w=0,x=0;s=s||15;var M=function(I,A,T){var k=T%2===1&&T>1;if(!m||I!=m.x||A!=m.y){m&&k?(E=m.x,v=m.y):(E=0,v=0);var L={x:E+I,y:v+A};(k||!m)&&(m=L),P.push(L),w=E+I,x=v+A}},S=function(I){var A=I.pathSegTypeAsLetter.toUpperCase();if(A!=="Z"){switch(A){case"M":case"L":case"T":case"C":case"S":case"Q":w=I.x,x=I.y;break;case"H":w=I.x;break;case"V":x=I.y;break}M(w,x,I.pathSegType)}};for(e._svgPathToAbsolute(a),d=a.getTotalLength(),i=[],g=0;g<a.pathSegList.numberOfItems;g+=1)i.push(a.pathSegList.getItem(g));for(n=i.concat();y<d;){if(C=a.getPathSegAtLength(y),t=i[C],t!=u){for(;n.length&&n[0]!=t;)S(n.shift());u=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":r=a.getPointAtLength(y),M(r.x,r.y,0);break}y+=s}for(g=0,l=n.length;g<l;++g)S(n[g]);return P},e._svgPathToAbsolute=function(a){for(var s,g,l,d,r,t,i=a.pathSegList,n=0,u=0,m=i.numberOfItems,C=0;C<m;++C){var P=i.getItem(C),E=P.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(E))"x"in P&&(n=P.x),"y"in P&&(u=P.y);else switch("x1"in P&&(l=n+P.x1),"x2"in P&&(r=n+P.x2),"y1"in P&&(d=u+P.y1),"y2"in P&&(t=u+P.y2),"x"in P&&(n+=P.x),"y"in P&&(u+=P.y),E){case"m":i.replaceItem(a.createSVGPathSegMovetoAbs(n,u),C);break;case"l":i.replaceItem(a.createSVGPathSegLinetoAbs(n,u),C);break;case"h":i.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(n),C);break;case"v":i.replaceItem(a.createSVGPathSegLinetoVerticalAbs(u),C);break;case"c":i.replaceItem(a.createSVGPathSegCurvetoCubicAbs(n,u,l,d,r,t),C);break;case"s":i.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(n,u,r,t),C);break;case"q":i.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(n,u,l,d),C);break;case"t":i.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(n,u),C);break;case"a":i.replaceItem(a.createSVGPathSegArcAbs(n,u,P.r1,P.r2,P.angle,P.largeArcFlag,P.sweepFlag),C);break;case"z":case"Z":n=s,u=g;break}(E=="M"||E=="m")&&(s=n,g=u)}}})()},function(c,p,h){var e={};c.exports=e;var o=h(6);h(0),function(){e.create=o.create,e.add=o.add,e.remove=o.remove,e.clear=o.clear,e.addComposite=o.addComposite,e.addBody=o.addBody,e.addConstraint=o.addConstraint}()}])})})(we);var Le=we.exports;const G=Te(Le);class ke{constructor(f,c){this.keys=new Map,this.mouseConstraint=f,this.eventsOn=c,this.justPressed=new Set,document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this))}addKey(f,c){this.keys.set(f,{isPressed:!1,callback:c})}removeKey(f){this.keys.delete(f)}handleKeyDown(f){if(f.repeat)return;const c=this.keys.get(f.key);c&&!c.isPressed&&(c.isPressed=!0,this.justPressed.add(f.key),c.callback&&c.callback(!0))}handleKeyUp(f){const c=this.keys.get(f.key);c&&(c.isPressed=!1,this.justPressed.delete(f.key),c.callback&&c.callback(!1))}update(){this.justPressed.clear()}isJustPressed(f){return this.justPressed.has(f)}pressedKeys(){const f=new Set;for(let[c,p]of this.keys)p.isPressed&&f.add(c);return f}}class Be{constructor(){this.layers=[],this.game=null}setGame(f){this.game=f}addLayer(f,c){c.sprite.game=this.game,this.layers.push([f,c])}clear(){this.layers=[]}draw(){for(let[f,c]of this.layers)this.drawLayer(f)}drawLayer(f){for(let[c,p]of this.layers)if(!(f!==void 0&&f!==c))for(let h of p.tiles)p.sprite.animations.get(h.anim)&&p.sprite.draw(h.anim,h.pos.x,h.pos.y,{game:this.game})}constructLayer(f,c,p,h,e){let o={sprite:f,tiles:[]};for(let a=0;a<c;a++)for(let s=0;s<p;s++)o.tiles.push({pos:{x:a*h,y:s*h},...e});return o}}const Re={default:1,player:2,platform:4,movingPlatform:8,enemy:16,coin:32,trigger:64};class Fe{constructor(f,c,p,h,e=c,o=p){this.tileW=c,this.tileH=p,this.width=e,this.height=o,this.animations=new Map,this.currentFrame=0,this.image=f,this.loaded=!0,this.game=h}define(f,c,p){this.animations.set(f,{tileX:c,tileY:p})}draw(f,c,p,h={}){if(!this.loaded)return;if(!this.game){console.error("Game instance not found");return}if(!f){this.game.renderer.drawSprite({image:this.image,x:c,y:p,tileWidth:this.tileW,tileHeight:this.tileH,tileX:this.currentFrame,tileY:0,...h});return}const e=this.animations.get(f);if(!e){console.warn(`Animation ${f} not found`);return}this.game.renderer.drawSprite({image:this.image,x:c,y:p,tileWidth:this.tileW,tileHeight:this.tileH,tileX:e.tileX+this.currentFrame,tileY:e.tileY,...h})}}class De{constructor(f){this.game=f,this.elements=new Set,this.hoveredElement=null}clear(){this.elements.clear(),this.hoveredElement=null}addElement(f){return f.setGame(this.game),this.elements.add(f),f}onMouseMove(f,c){let p=null;Array.from(this.elements).filter(e=>e.contains(f,c)).reverse().forEach(e=>{e.onMouseMove(f,c),e.isHovered&&(p=e)}),this.hoveredElement!==p&&(this.hoveredElement&&(this.hoveredElement.isHovered=!1,this.hoveredElement.onMouseLeave()),this.hoveredElement=p,p&&p.onMouseEnter())}onMouseDown(f,c){const p=Array.from(this.elements).filter(h=>h.contains(f,c)).reverse();for(const h of p)if(h.onMouseDown(f,c))break}update(f){for(const c of this.elements)c.update(f)}draw(f){for(const c of this.elements)c.draw(f)}}class Z{constructor(f,c,p,h){this.x=f,this.y=c,this.width=p,this.height=h,this.visible=!0,this.isHovered=!1,this.isFocused=!1,this.game=null,this.stopPropagation=!1}setGame(f){this.game=f}update(f){}draw(f){}contains(f,c){return this.game.uiRenderer.hitTest(f,c,{type:"rect",x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height})}onMouseMove(f,c){const p=this.isHovered;return this.isHovered=this.contains(f,c),p!==this.isHovered&&(this.isHovered?this.onMouseEnter():this.onMouseLeave()),this.stopPropagation}onMouseDown(f,c){return this.contains(f,c)?(this.onClick(f,c),this.stopPropagation):!1}onMouseEnter(){}onMouseLeave(){}onClick(f,c){}onFocus(){this.isFocused=!0}onBlur(){this.isFocused=!1}destroy(){this.visible=!1,this.isHovered=!1,this.isFocused=!1}}class He extends Z{constructor(f,c,p,h,e,o,a={}){super(f,c),this.width=p,this.height=h,this.text=e,this.handleClick=o,this.backgroundColor=a.backgroundColor||"#000",this.hoverColor=a.hoverColor||"#333",this.textColor=a.textColor||"#fff",this.fontSize=a.fontSize||"16px",this.fontFamily=a.fontFamily||"system-ui",this.isHovered=!1}draw(){if(!this.game)return;const f=this.isHovered?this.hoverColor:this.backgroundColor;this.game.uiRenderer.drawRect({x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height,fillStyle:f}),this.game.uiRenderer.drawText({text:this.text,x:this.x,y:this.y,fillStyle:this.textColor,fontSize:this.fontSize,fontFamily:this.fontFamily,textAlign:"center",textBaseline:"middle"})}onMouseEnter(){this.isHovered=!0,this.game.uiRenderer.setCursor("pointer")}onMouseLeave(){this.isHovered=!1,this.game.uiRenderer.setCursor("default")}onClick(){this.handleClick&&this.handleClick()}}class We extends Z{constructor(f,c,p,h={}){super(f,c),this.text=p,this.fontSize=h.fontSize||"16px",this.color=h.color||"#000",this.align=h.align||"left"}draw(){this.game&&this.game.uiRenderer.drawText({text:this.text,x:this.x,y:this.y,fillStyle:this.color,fontSize:this.fontSize,textAlign:this.align,textBaseline:"top"})}}class Oe extends Z{constructor(f,c,p,h={}){super(f,c),this.image=p,this.width=h.width||p.width,this.height=h.height||p.height,this.scale=h.scale||1}draw(){this.game&&this.game.uiRenderer.drawImage(this.image,this.x,this.y,{width:this.width,height:this.height,scale:this.scale})}}class Ve extends Z{constructor(f,c,p,h,e,o={}){super(f,c),this.width=p,this.height=h,this.color=e,this.interactive=o.interactive||!1}draw(){this.game&&this.game.uiRenderer.drawRect({x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height,fillStyle:this.color})}contains(f,c){return this.interactive?super.contains(f,c):!1}}class ze extends Z{constructor(f,c,p,h={}){super(c,p),this.options={show:h.show??!1,textColor:h.textColor??"#00ff00",font:{size:h.fontSize??"14px",family:h.fontFamily??"monospace"}},this.game=f}draw(){if(!this.game||!this.options.show)return;const f=this.game.renderer,c=f.getFPS(),p=f.getAverageFPS(),h=f.getStats(),e="FPS: "+c+" · Avg FPS: "+p+" · Draw Calls: "+h.drawCalls+" · State Changes: "+h.stateChanges+" · Sprites: "+h.spritesDrawn+" · Text: "+h.textDrawn+" · Shapes: "+h.shapesDrawn;this.game.uiRenderer.drawText({text:e,x:this.x,y:this.y,fillStyle:this.options.textColor,fontSize:this.options.font.size,fontFamily:this.options.font.family,textAlign:"left",textBaseline:"top"})}}class Ue{constructor(f,c){this.game=f,this.config=c,this.sprites=new Map,this.spriteSheets=new Map,this.ui=new De(f),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseDown=this._handleMouseDown.bind(this)}_handleMouseMove(f){const c=this.game.canvas.getBoundingClientRect(),p=(f.clientX-c.left)*(this.game.canvas.width/c.width),h=(f.clientY-c.top)*(this.game.canvas.height/c.height);this.ui.onMouseMove(p,h)}_handleMouseDown(f){const c=this.game.canvas.getBoundingClientRect(),p=(f.clientX-c.left)*(this.game.canvas.width/c.width),h=(f.clientY-c.top)*(this.game.canvas.height/c.height);this.ui.onMouseDown(p,h)}async load(){await this.loadAssets(),this.setupScene(),this.game.canvas.addEventListener("mousemove",this._handleMouseMove),this.game.canvas.addEventListener("mousedown",this._handleMouseDown),this.game.camera.init(this),this.config.type==="level"?(console.debug("Setting up level scene"),await this.setupLevelScene()):(console.debug("Setting up UI scene"),await this.setupUIScene()),this.config.onEnter&&this.config.onEnter()}async loadAssets(){var c;if(!((c=this.config.assets)!=null&&c.spritesheets))return;const f=Object.entries(this.config.assets.spritesheets).map(([p,h])=>new Promise((e,o)=>{const a=new window.Image;a.onload=()=>{const s=new Fe(a,h.frameWidth,h.frameHeight,this.game);this.sprites.set(p,a),this.spriteSheets.set(p,s),h.animations?Object.entries(h.animations).forEach(([g,l])=>{l.frames.forEach(([d,r])=>{s.define(g,d,r)})}):s.define("default",0,0),e()},a.onerror=s=>{console.error(`Failed to load sprite: ${h.url}`,s),o(s)},a.src=h.url}));try{await Promise.all(f)}catch(p){throw console.error("Error loading sprites:",p),p}}setupScene(){this.game.entities.clear(),G.Composite.clear(this.game.engine.world),this.game.layers.clear(),this.game.player=null,this.ui.clear();const f=new ze(this.game,20,20,{textColor:"#00ff00",show:!0});this.ui.addElement(f),this.config.world&&(G.Engine.clear(this.game.engine),G.Engine.update(this.game.engine,0),this.config.world.gravity&&(this.game.engine.gravity=this.config.world.gravity)),this.config.background&&this.setupBackground(this.config.background)}setupBackground([f,c,p]){const[h,e]=this.config.sprites[f],o=this.spriteSheets.get(h);if(!o){console.error(`Sprite not found: ${h}`);return}o.define("default",c,p);const a=Math.ceil(this.game.width/e),s=Math.ceil(this.game.height/e),g=this.game.layers.constructLayer(o,a,s,e,{anim:"default"});this.game.layers.addLayer("background",g)}async setupLevelScene(){this.config.layers&&this.config.layers.forEach(f=>{f.objects.forEach(c=>{const p=this.config.prefabs[c.prefab];if(!p){console.error(`Prefab not found: ${c.prefab}`);return}const h=this.createPrefabInstance({type:p.actor,position:[c.x,c.y],size:[c.width,c.height],sprite:p.spritesheet,defaultAnimation:p.defaultAnimation,physics:p.physics,options:c.properties});h&&(p.actor==="Player"&&(this.game.player=h,this.game.camera.follow(h)),this.game.entities.add(h),G.Composite.add(this.game.engine.world,h.body))})})}createPrefabInstance(f){const c=this.spriteSheets.get(f.sprite),p=this.game.createEntity(f.type,f.position[0],f.position[1],f.size[0],f.size[1],c,f.options,f.physics);return p?(p.setAnimation(f.defaultAnimation||"default"),p):null}async setupUIScene(){this.config.elements&&this.config.elements.forEach(f=>{var c;switch(f.type){case"button":const p=new He(f.x,f.y,f.properties.width||200,f.properties.height||40,f.properties.text,()=>{f.properties.onClick&&this.game.sceneManager.switchTo(f.properties.onClick)},{backgroundColor:f.properties.backgroundColor,hoverColor:f.properties.hoverColor,textColor:f.properties.textColor,fontSize:f.properties.fontSize,fontFamily:f.properties.fontFamily});p.setGame(this.game),this.ui.addElement(p);break;case"text":const h=new We(f.x,f.y,f.properties.text,{fontSize:f.properties.fontSize,color:f.properties.color,align:f.properties.align});h.setGame(this.game),this.ui.addElement(h);break;case"image":if(f.sprite){const o=this.sprites.get(f.sprite),a=new Oe(f.x,f.y,o,{width:f.properties.width,height:f.properties.height,scale:f.properties.scale});a.setGame(this.game),this.ui.addElement(a)}break;case"rect":const e=new Ve(f.x,f.y,f.width,f.height,f.color,{interactive:((c=f.properties)==null?void 0:c.interactive)||!1});e.setGame(this.game),this.ui.addElement(e);break}})}unload(){this.config.onExit&&this.config.onExit(),this.sprites.clear(),this.spriteSheets.clear(),this.ui.clear(),this.game.renderer.setCursor("default"),this.game.canvas.removeEventListener("mousemove",this._handleMouseMove),this.game.canvas.removeEventListener("mousedown",this._handleMouseDown)}update(f){if(this.config.type==="level"){if(G.Engine.update(this.game.engine,f*1e3),this.game.player&&this.game.player.body.position.y>this.game.options.worldHeight+50){console.log("Game Over!"),this.game.gameOver();return}this.game.camera.update(),this.game.entities.forEach(c=>c.update(f))}this.ui.update(f)}draw(f){this.config.type==="level"&&(this.game.layers.drawLayer("background"),this.game.entities.forEach(c=>c.draw(f)))}drawUI(f){this.ui.draw(f)}}class Ge{constructor(f){this.game=f,this.spriteIndices=new Map}async loadScene(f){if(!f.version||!f.type)throw new Error("Invalid scene format");return f.type==="level"?this.loadLevelScene(f):this.loadUIScene(f)}async loadLevelScene(f){return this.mapSprites(f.assets.spritesheets),{name:f.name,type:"level",title:f.title||f.name,gameType:f.gameType,world:f.world,sprites:this.getSpritesArray(f),player:this.createPlayerEntity(f),entities:this.createEntities(f)}}mapSprites(f){this.spriteIndices.clear(),Object.keys(f).forEach((c,p)=>{this.spriteIndices.set(c,p)})}getSpritesArray(f){return Object.entries(f.assets.spritesheets).map(([c,p])=>[p.url,p.frameWidth])}createPlayerEntity(f){const c=f.layers.find(e=>e.objects.some(o=>o.prefab==="player"));if(!c)return null;const p=c.objects.find(e=>e.prefab==="player");if(!p)return null;const h=f.prefabs.player;return this.createEntity(p,h)}createEntities(f){return f.layers.flatMap(c=>c.objects.filter(p=>p.prefab!=="player").map(p=>this.createEntity(p,f.prefabs[p.prefab])))}createEntity(f,c){return{actor:c.actor,position:[f.x,f.y],size:[f.width||32,f.height||32],sprite:this.spriteIndices.get(c.spritesheet),animations:this.createAnimations(c),options:f.properties,physics:c.physics}}createAnimations(f){const c=f.spritesheet;if(c!=null&&c.animations)return Object.entries(c.animations).map(([p,h])=>[p,...h.frames[0],h.loop])}async loadUIScene(f){return{name:f.name,type:"ui",title:f.title||f.name,assets:f.assets,elements:f.elements.map(c=>({type:c.type,id:c.id,x:c.x,y:c.y,...c.properties}))}}}class be{constructor(f){this.game=f,this.scenes=new Map,this.currentScene=null,this.loader=new Ge(f),this.scenesToLoad=[],this.loading=!0}addScene(f,c){this.scenesToLoad.push({name:f,scene:c})}async loadScene(f,c){this.loading=!0;try{const p=await f.fetch();if(!p)throw console.error("Failed to load scene",f),new Error("Failed to load scene");return this.scenes.set(c,new Ue(this.game,p)),this.scenesToLoad=this.scenesToLoad.filter(h=>h.name!==c),this.scenes.get(c)}catch(p){throw console.error("Error loading scene:",p),p}finally{this.loading=!1}}async switchTo(f){let c=this.scenes.get(f);if(c)this.loading=!1;else{const p=this.scenesToLoad.find(h=>h.name===f);if(!p)throw new Error(`Scene ${f} not found`);c=await this.loadScene(p.scene,f)}return this.currentScene&&this.currentScene.unload(),this.currentScene=c,await c.load(),c}getCurrentScene(){return this.currentScene}}class $e{constructor(f,c,p={}){this.x=0,this.y=0,this.width=f,this.height=c,this.target=null,this.lerp=p.lerp||.1,this.bounds=p.bounds||null,this.padding=p.padding||{x:100,y:100}}init(f){this.scene=f,this.width=f.game.canvas.width,this.height=f.game.canvas.height}follow(f){this.target=f}update(){if(!this.target)return;const f=this.target.body.position.x,c=this.target.body.position.y;if(this.x+=(f-this.x)*this.lerp,this.y+=(c-this.y)*this.lerp,this.bounds){const p=this.width/2,h=this.height/2;this.x=Math.max(this.bounds.left+p,Math.min(this.bounds.right-p,this.x)),this.y=Math.max(this.bounds.top+h,Math.min(this.bounds.bottom-h,this.y))}}isVisible(f,c,p,h){const e=f-this.x+this.width/2,o=c-this.y+this.height/2;return e+p>=-this.padding.x&&e<=this.width+this.padding.x&&o+h>=-this.padding.y&&o<=this.height+this.padding.y}worldToScreen(f,c){return{x:f-this.x+this.width/2,y:c-this.y+this.height/2}}screenToWorld(f,c){return{x:f+this.x-this.width/2,y:c+this.y-this.height/2}}getVisibleArea(){return{left:this.x-this.width/2,right:this.x+this.width/2,top:this.y-this.height/2,bottom:this.y+this.height/2}}resize(f,c){this.width=f,this.height=c}}class Ke{constructor(){this.sounds=new Map,this.music=new Map,this.currentMusic=null,this.isMuted=!1,this.soundVolume=1,this.musicVolume=.5,this.pendingMusic=null,this.isInitialized=!1,document.addEventListener("click",()=>this.initialize(),{once:!0}),document.addEventListener("keydown",()=>this.initialize(),{once:!0})}initialize(){this.isInitialized||(this.isInitialized=!0,this.pendingMusic&&(this.playMusic(this.pendingMusic),this.pendingMusic=null))}loadSound(f,c){const p=new Audio(c);this.sounds.set(f,p)}loadMusic(f,c){const p=new Audio(c);p.loop=!0,this.music.set(f,p)}playSound(f){if(this.isMuted)return;const c=this.sounds.get(f);if(!c){console.warn(`Sound not found: ${f}`);return}const p=c.cloneNode();p.volume=this.soundVolume,p.play().catch(h=>{console.warn(`Failed to play sound ${f}:`,h)})}playMusic(f){if(!this.isInitialized){this.pendingMusic=f;return}if(this.isMuted)return;this.currentMusic&&(this.currentMusic.pause(),this.currentMusic.currentTime=0);const c=this.music.get(f);if(!c){console.warn(`Music not found: ${f}`);return}c.volume=this.musicVolume,this.currentMusic=c,c.play().catch(p=>{console.warn(`Failed to play music ${f}:`,p)})}stopMusic(){this.currentMusic&&(this.currentMusic.pause(),this.currentMusic.currentTime=0,this.currentMusic=null)}toggleMute(){this.isMuted=!this.isMuted,this.isMuted&&this.stopMusic()}setMusicVolume(f){this.musicVolume=Math.max(0,Math.min(1,f)),this.currentMusic&&!this.isMuted&&(this.currentMusic.volume=this.musicVolume)}setSoundVolume(f){this.soundVolume=Math.max(0,Math.min(1,f))}}const pe="d",xe="m",ye="r",Je="x",je=" ",qe="ArrowLeft",_e="ArrowUp",et="ArrowRight",tt="ArrowDown";class re{constructor(){if(this.constructor===re)throw new Error("BaseRenderer is an abstract class and cannot be instantiated directly")}init(f,c){throw new Error("Method not implemented")}destroy(){throw new Error("Method not implemented")}resize(f,c){throw new Error("Method not implemented")}clear(f){throw new Error("Method not implemented")}beginFrame(){throw new Error("Method not implemented")}endFrame(){throw new Error("Method not implemented")}drawSprite(f){throw new Error("Method not implemented")}drawAnimation(f){throw new Error("Method not implemented")}drawRect(f){throw new Error("Method not implemented")}drawText(f){throw new Error("Method not implemented")}applyCamera(f){throw new Error("Method not implemented")}setCursor(f){throw new Error("Method not implemented")}setDebugEnabled(f){throw new Error("setDebugEnabled not implemented")}isDebugEnabled(){throw new Error("isDebugEnabled not implemented")}setDebugLayer(f){throw new Error("setDebugLayer not implemented")}getDebugLayer(){throw new Error("getDebugLayer not implemented")}}var X,Q;class Ye extends re{constructor(){super();ie(this,X,!0);ie(this,Q,"default");this.canvas=null,this.context=null,this.worldBuffer=null,this.worldContext=null,this.width=800,this.height=600,this.frameCount=0,this.fps=0,this.lastFpsUpdate=performance.now(),this.fpsUpdateInterval=1e3,this.fpsHistory=new Array(60).fill(0),this.fpsHistoryIndex=0,this.fpsSum=0,this.fpsCount=0,this.stats={drawCalls:0,stateChanges:0,spritesDrawn:0,textDrawn:0,shapesDrawn:0,lastState:{fillStyle:null,strokeStyle:null,lineWidth:null,font:null}}}init(c,p={}){this.canvas=c,this.context=this.canvas.getContext("2d"),this.worldBuffer=document.createElement("canvas"),this.worldContext=this.worldBuffer.getContext("2d"),this.width=p.width||this.width,this.height=p.height||this.height,this.resize()}destroy(){this.canvas=null,this.context=null,this.worldBuffer=null,this.worldContext=null}resize(c,p){this.canvas&&(c!==void 0&&p!==void 0&&(this.width=c,this.height=p),this.canvas.width=this.width,this.canvas.height=this.height,this.worldBuffer.width=this.width,this.worldBuffer.height=this.height)}clear(c="#000"){this.context&&(this.context.fillStyle=c,this.context.fillRect(0,0,this.width,this.height),this.worldContext.fillStyle=c,this.worldContext.fillRect(0,0,this.width,this.height))}drawWorld(c){this.worldContext&&(this.worldContext.clearRect(0,0,this.width,this.height),this.worldContext.save(),c(this.worldContext),this.worldContext.restore(),this.context.drawImage(this.worldBuffer,0,0))}drawScreen(c){this.context&&(this.context.save(),c(this.context),this.context.restore())}drawSprite(c){const p=c.isScreenSpace?this.context:this.worldContext;if(!p||!c.image)return;this.stats.drawCalls++,this.stats.spritesDrawn++,this.trackStateChange(p,{});const{image:h,x:e,y:o,tileX:a=0,tileY:s=0,tileWidth:g,tileHeight:l,width:d=g,height:r=l,rotation:t=0,flipX:i=!1,flipY:n=!1}=c;p.save(),p.translate(e,o),t&&p.rotate(t),(i||n)&&p.scale(i?-1:1,n?-1:1),p.drawImage(h,a*g,s*l,g,l,-d/2,-r/2,d,r),p.restore()}drawAnimation(c){const{sprite:p,x:h,y:e,animation:o,frame:a=0,transform:s={}}=c,g=p.animations.get(o);g&&this.drawSprite({image:p.image,x:h,y:e,tileX:g.tileX+a,tileY:g.tileY,tileWidth:p.tileW,tileHeight:p.tileH,...s})}applyCamera(c){this.worldContext&&this.worldContext.translate(-c.x+c.width/2,-c.y+c.height/2)}getContext(){return this.context}getWorldContext(){return this.worldContext}drawRect(c){const p=c.isScreenSpace?this.context:this.worldContext;p&&(this.stats.drawCalls++,this.stats.shapesDrawn++,this.trackStateChange(p,{fillStyle:c.fillStyle,strokeStyle:c.strokeStyle,lineWidth:c.lineWidth}),p.save(),c.strokeStyle&&(p.strokeStyle=c.strokeStyle,p.lineWidth=c.lineWidth||1),c.fillStyle&&(p.fillStyle=c.fillStyle),c.fill!==!1&&c.fillStyle&&p.fillRect(c.x,c.y,c.width,c.height),c.strokeStyle&&p.strokeRect(c.x,c.y,c.width,c.height),p.restore())}drawText(c){const p=c.isScreenSpace?this.context:this.worldContext;p&&(this.stats.drawCalls++,this.stats.textDrawn++,this.trackStateChange(p,{fillStyle:c.fillStyle,font:`${c.fontWeight||"normal"} ${c.fontSize||"16px"} ${c.fontFamily||"system-ui"}`.trim()}),p.save(),p.fillStyle=c.fillStyle||"#000",p.font=`${c.fontWeight||"normal"} ${c.fontSize||"16px"} ${c.fontFamily||"system-ui"}`.trim(),p.textAlign=c.textAlign||"left",p.textBaseline=c.textBaseline||"top",p.fillText(c.text,c.x,c.y),p.restore())}drawLine(c){const p=c.isScreenSpace?this.context:this.worldContext;p&&(this.stats.drawCalls++,this.stats.shapesDrawn++,this.trackStateChange(p,{strokeStyle:c.strokeStyle,lineWidth:c.lineWidth}),p.save(),p.strokeStyle=c.strokeStyle||"#000",p.lineWidth=c.lineWidth||1,p.beginPath(),p.moveTo(c.x1,c.y1),p.lineTo(c.x2,c.y2),p.stroke(),p.restore())}drawArc(c){const p=c.isScreenSpace?this.context:this.worldContext;p&&(this.stats.drawCalls++,this.stats.shapesDrawn++,this.trackStateChange(p,{fillStyle:c.fillStyle,strokeStyle:c.strokeStyle,lineWidth:c.lineWidth}),p.save(),c.strokeStyle&&(p.strokeStyle=c.strokeStyle,p.lineWidth=c.lineWidth||1),c.fillStyle&&(p.fillStyle=c.fillStyle),p.beginPath(),p.arc(c.x,c.y,c.radius,c.startAngle,c.endAngle,!1),c.fill!==!1&&c.fillStyle&&p.fill(),c.strokeStyle&&p.stroke(),p.restore())}setCursor(c){this.canvas&&(this.canvas.style.cursor=c)}beginFrame(){if(!this.worldContext)return;this.clear("#000"),this.worldContext.save(),this.frameCount++,this.resetStats();const c=performance.now(),p=c-this.lastFpsUpdate;p>=this.fpsUpdateInterval&&(this.fps=Math.round(this.frameCount*1e3/p),this.fpsCount===this.fpsHistory.length?this.fpsSum-=this.fpsHistory[this.fpsHistoryIndex]:this.fpsCount++,this.fpsSum+=this.fps,this.fpsHistory[this.fpsHistoryIndex]=this.fps,this.fpsHistoryIndex=(this.fpsHistoryIndex+1)%this.fpsHistory.length,this.frameCount=0,this.lastFpsUpdate=c)}endFrame(){this.worldContext&&(this.worldContext.restore(),this.context.drawImage(this.worldBuffer,0,0))}setDebugEnabled(c){ne(this,X,c)}isDebugEnabled(){return te(this,X)}setDebugLayer(c){ne(this,Q,c)}getDebugLayer(){return te(this,Q)}getFPS(){return this.fps}getFPSHistory(){return[...this.fpsHistory]}getAverageFPS(){return this.fpsCount===0?this.fps:Math.round(this.fpsSum/this.fpsCount)}resetStats(){this.stats.drawCalls=0,this.stats.stateChanges=0,this.stats.spritesDrawn=0,this.stats.textDrawn=0,this.stats.shapesDrawn=0}trackStateChange(c,p){const h=this.stats.lastState;let e=0;for(const[o,a]of Object.entries(p))a!==void 0&&a!==h[o]&&(h[o]=a,e++);e>0&&(this.stats.stateChanges+=e)}getStats(){return{...this.stats}}}X=new WeakMap,Q=new WeakMap;class ae{constructor(){if(this.constructor===ae)throw new Error("BaseUIRenderer is an abstract class and cannot be instantiated directly")}init(f,c){throw new Error("Method not implemented")}destroy(){throw new Error("Method not implemented")}resize(f,c){throw new Error("Method not implemented")}clear(f){throw new Error("Method not implemented")}beginFrame(){throw new Error("Method not implemented")}endFrame(){throw new Error("Method not implemented")}drawRect(f){throw new Error("Method not implemented")}drawText(f){throw new Error("Method not implemented")}drawImage(f){throw new Error("Method not implemented")}drawPath(f){throw new Error("Method not implemented")}pushClip(f){throw new Error("Method not implemented")}popClip(){throw new Error("Method not implemented")}measureText(f,c){throw new Error("Method not implemented")}hitTest(f,c,p){throw new Error("Method not implemented")}setCursor(f){throw new Error("Method not implemented")}}class Ne extends ae{constructor(){super(),this.canvas=null,this.context=null,this.width=800,this.height=600,this.clipStack=[]}init(f,c={}){this.canvas=f,this.context=this.canvas.getContext("2d"),this.width=c.width||this.width,this.height=c.height||this.height,this.resize(this.width,this.height)}destroy(){this.canvas=null,this.context=null,this.clipStack=[]}resize(f,c){this.canvas&&(this.width=f,this.height=c,this.canvas.width=f,this.canvas.height=c)}clear(f){this.context&&(f?(this.context.fillStyle=f,this.context.fillRect(0,0,this.width,this.height)):this.context.clearRect(0,0,this.width,this.height))}beginFrame(){this.context&&this.context.save()}endFrame(){this.context&&this.context.restore()}drawRect(f){this.context&&(this.context.save(),f.globalAlpha!==void 0&&(this.context.globalAlpha=f.globalAlpha),f.strokeStyle&&(this.context.strokeStyle=f.strokeStyle,this.context.lineWidth=f.lineWidth||1),f.fillStyle&&(this.context.fillStyle=f.fillStyle),f.fill!==!1&&f.fillStyle&&this.context.fillRect(f.x,f.y,f.width,f.height),f.strokeStyle&&this.context.strokeRect(f.x,f.y,f.width,f.height),this.context.restore())}drawText(f){this.context&&(this.context.save(),f.globalAlpha!==void 0&&(this.context.globalAlpha=f.globalAlpha),this.context.fillStyle=f.fillStyle||"#000",this.context.font=`${f.fontSize||"16px"} ${f.fontFamily||"system-ui"}`,this.context.textAlign=f.textAlign||"left",this.context.textBaseline=f.textBaseline||"top",this.context.fillText(f.text,f.x,f.y),this.context.restore())}drawImage(f){!this.context||!f.image||(this.context.save(),f.globalAlpha!==void 0&&(this.context.globalAlpha=f.globalAlpha),this.context.drawImage(f.image,f.x,f.y,f.width||f.image.width,f.height||f.image.height),this.context.restore())}drawPath(f){if(!(!this.context||!f.points||f.points.length<2)){this.context.save(),f.globalAlpha!==void 0&&(this.context.globalAlpha=f.globalAlpha),this.context.beginPath(),this.context.moveTo(f.points[0].x,f.points[0].y);for(let c=1;c<f.points.length;c++)this.context.lineTo(f.points[c].x,f.points[c].y);f.closed&&this.context.closePath(),f.fillStyle&&(this.context.fillStyle=f.fillStyle,this.context.fill()),f.strokeStyle&&(this.context.strokeStyle=f.strokeStyle,this.context.lineWidth=f.lineWidth||1,this.context.stroke()),this.context.restore()}}pushClip(f){this.context&&(this.clipStack.push(f),this.context.save(),this.context.beginPath(),this.context.rect(f.x,f.y,f.width,f.height),this.context.clip())}popClip(){!this.context||this.clipStack.length===0||(this.clipStack.pop(),this.context.restore())}measureText(f,c={}){if(!this.context)return{width:0,height:0};this.context.save(),this.context.font=c.font||"16px Arial";const p=this.context.measureText(f);return this.context.restore(),{width:p.width,height:parseInt(c.font)||16}}hitTest(f,c,p){if(!this.context)return!1;switch(p.type){case"rect":{const h=p.x,e=p.x+p.width,o=p.y,a=p.y+p.height;return f>=h&&f<=e&&c>=o&&c<=a}case"circle":{const h=f-p.x,e=c-p.y;return h*h+e*e<=p.radius*p.radius}default:return!1}}setCursor(f){this.canvas&&(this.canvas.style.cursor=f)}}const Xe={levelNames:[],currentLevel:null,levelsPath:"./levels/",initialScene:null,width:1280,height:720,worldWidth:1920,worldHeight:1080,sounds:{},music:{}};class it{constructor(f,c={}){this.options={...Xe,...c},this.renderer=new Ye,this.uiRenderer=new Ne,this.renderer.init(f,{width:this.options.width,height:this.options.height}),this.uiRenderer.init(f,{width:this.options.width,height:this.options.height}),this.canvas=f,this.context=this.renderer.getContext(),this.canvas.width=this.options.width,this.canvas.height=this.options.height,this.camera=new $e(this.options.width,this.options.height,{worldWidth:this.options.worldWidth,worldHeight:this.options.worldHeight,smoothing:.1}),this.engine=G.Engine.create(),this.collisionCategories=Re,this.Body=G.Body,this.Bodies=G.Bodies,this.entities=new Set,this.player=null,this.actors=new Map,this.isGameOver=!1,this.keys=new ke,this.layers=new Be,this.layers.setGame(this),this.sceneManager=new be(this),this.soundManager=new Ke,this.keys.addKey(ye),this.keys.addKey(xe),this.keys.addKey(pe),this.update=this.update.bind(this),this.lastTime=0}resize(){const f=this.canvas.clientWidth,c=this.canvas.clientHeight;this.renderer.resize(f,c),this.uiRenderer.resize(f,c)}registerActor(f,c){this.actors.set(f,c)}createEntity(f,c,p,h,e,o,a={},s={}){const g=this.actors.get(f);if(!g)return console.error(`Actor type not registered: ${f}`),null;console.debug(`Creating ${f} at ${c}, ${p} with size ${h}x${e}`);const l=G.Bodies.rectangle(c,p,h,e,{isStatic:s.bodyType==="static",isSensor:s.isSensor||!1,friction:s.friction||.1,frictionStatic:s.frictionStatic||.5,frictionAir:s.frictionAir||.01,restitution:s.restitution||0});l.entity=null;const d=new g(l,o,this,a);return l.entity=d,d}gameOver(){this.isGameOver=!0,this.soundManager.playSound("gameOver")}drawUIBackground(){this.uiRenderer.drawRect({x:0,y:0,width:this.canvas.width,height:this.canvas.height,fillStyle:"rgba(0, 0, 0, 0.7)"})}drawUIText(f,c,p=24,h=!1){this.uiRenderer.drawText({text:f,x:this.canvas.width/2,y:c,fillStyle:"#fff",fontSize:`${p}px`,fontFamily:"system-ui",fontWeight:h?"bold":"normal",textAlign:"center",textBaseline:"middle"})}drawGameOver(){this.uiRenderer.beginFrame(),this.drawUIBackground(),this.drawUIText("Game Over",this.canvas.height/2-40,48,!0),this.drawUIText("Press R to restart",this.canvas.height/2+20),this.drawUIText("Press M for menu",this.canvas.height/2+60),this.uiRenderer.endFrame()}drawLoading(){this.uiRenderer.beginFrame(),this.drawUIBackground("rgb(0, 0, 0)"),this.drawUIText("Loading...",this.canvas.height/2,64),this.uiRenderer.endFrame(),console.debug("drawing loading")}drawWorld(f){this.renderer.beginFrame(),this.renderer.applyCamera(this.camera),f.draw(),this.renderer.endFrame()}drawUI(f){this.uiRenderer.beginFrame(),f.drawUI(),this.uiRenderer.endFrame()}update(f){if(!this.lastTime){this.lastTime=f,requestAnimationFrame(this.update);return}const c=Math.min((f-this.lastTime)/1e3,.1);if(this.lastTime=f,this.renderer.clear("#000"),this.keys.isJustPressed(pe)&&this.renderer.setDebugEnabled(!this.renderer.isDebugEnabled()),this.sceneManager.loading){this.drawLoading(),requestAnimationFrame(this.update);return}G.Engine.update(this.engine,c*1e3,1);const p=this.sceneManager.getCurrentScene();this.isGameOver?(p&&this.drawWorld(p),this.drawGameOver(),this.keys.pressedKeys().has(ye)?(this.isGameOver=!1,this.reset(),p.load()):this.keys.pressedKeys().has(xe)&&(this.isGameOver=!1,this.reset(),this.sceneManager.switchTo("mainMenu"))):p&&(this.camera.update(),p.update(c),this.drawWorld(p),this.drawUI(p)),this.keys.update(),requestAnimationFrame(this.update)}async start(){this.drawLoading(),Object.entries(this.options.sounds||{}).forEach(([f,c])=>this.soundManager.loadSound(f,c)),Object.entries(this.options.music||{}).forEach(([f,c])=>this.soundManager.loadMusic(f,c)),this.options.initialScene?await this.sceneManager.switchTo(this.options.initialScene):this.options.currentLevel&&await this.sceneManager.switchTo(this.options.currentLevel),this.setupCollisionHandlers(),this.update()}reset(){G.Events.off(this.engine),G.World.clear(this.engine.world),G.Engine.clear(this.engine),G.Composite.clear(this.engine.world),this.engine.world=G.World.create(),this.engine=null,this.engine=G.Engine.create(),this.entities.clear(),this.layers.clear(),this.player=null,this.lastTime=0,this.camera.x=0,this.camera.y=0,this.camera.target=null,this.setupCollisionHandlers(),this.soundManager.stopMusic()}setupCollisionHandlers(){G.Events.on(this.engine,"collisionStart",f=>{f.pairs.forEach(c=>{const{bodyA:p,bodyB:h}=c;p.entity&&p.entity.onCollisionStart(h),h.entity&&h.entity.onCollisionStart(p)})}),G.Events.on(this.engine,"collisionEnd",f=>{f.pairs.forEach(c=>{const{bodyA:p,bodyB:h}=c;p.entity&&p.entity.onCollisionEnd(h),h.entity&&h.entity.onCollisionEnd(p)})})}getMousePosition(f){const c=this.canvas.getBoundingClientRect(),p=f.clientX-c.left,h=f.clientY-c.top,e=this.canvas.width/c.width,o=this.canvas.height/c.height;return this.camera.screenToWorld(p*e,h*o)}}export{Re as C,qe as K,G as M,Ze as _,et as a,_e as b,tt as c,je as d,Je as e,it as f};
